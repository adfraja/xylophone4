<?xml version="1.0" encoding="UTF-8"?>
<STEP-ProductInformation ContextID="DE-de" WorkspaceID="Approved" UseContextLocale="false">
    <STEPWorkflows>
        <STEPWorkflow ID="PMDM.WF.ProductOnboarding" Referenced="true"><!-- Definition:
<scxml name="PMDM.WF.ProductOnboarding" initial="State-1" version="0.9">
  <assignee id="$current" type="user"/>
  <datamodel>
    <data id="BuyerUserID"/>
    <data id="ContentManagerUserID"/>
    <data id="IsNewOrUpdate"/>
    <data id="MessageToRetailer"/>
    <data id="MessageToSupplier"/>
    <data id="ProposalStatus" attribute="PMDM.AT.ProposalStatus"/>
    <data id="SupplierUserID"/>
  </datamodel>
  <editorLayout>   node-size-and-position x=0.0 y=0.0 w=850.0 h=730.0  </editorLayout>
  <final id="State-9" name="External Record Created" discontinued="false">
    <editorLayout>   node-size-and-position x=350.0 y=650.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-bdab400d-b94c-4476-ac1e-4a124c9230b9"/>
  </final>
  <state id="State-1" name="Proposal" discontinued="false">
    <transition businessactionid="acn-899c0ab3-bfe0-49d2-b9f7-587148b216af" event="Submit" target="State-2"/>
    <assignee id="PMDM.UG.Suppliers" type="group"/>
    <editorLayout>   node-size-and-position x=350.0 y=70.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-abf5c7de-5acb-4009-b73f-44d94df31062"/>
    <onexit businessactionid="acn-1458ff20-89c8-4a46-8d7f-a3cd029bada9"/>
  </state>
  <state id="State-2" name="Buyer Approval" discontinued="false">
    <transition businessactionid="acn-578ca828-bbbd-48c7-ae4f-3d60881806b4" businessconditionid="con-b7256efc-20fe-4175-9f2d-64d5b30be521" event="Proceed" target="State-3"/>
    <assignee id="PMDM.UG.BrandsTeam" type="group"/>
    <editorLayout>   node-size-and-position x=350.0 y=160.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-023fd610-97bb-45b6-8695-ca652300b4f7"/>
    <onexit businessactionid="acn-4f301fc8-3ad8-43be-828e-2c8c21adb705"/>
  </state>
  <state id="State-3" name="Automatic Forwarding" discontinued="false">
    <transition businessactionid="acn-bffd49c2-e0d0-4471-ab49-71eeb80262bc" event="Rework" target="State-4"/>
    <transition businessactionid="acn-819f91fe-0c4d-4783-baa3-5b423900fcff" event="Rejected" target="State-5">
      <editorLayout>   edge-path [State-5]  x=740.0 y=270.0  </editorLayout>
    </transition>
    <transition businessactionid="acn-47465974-ece8-46ba-9e18-9021f1774dab" event="Waiting" target="State-6">
      <editorLayout>   edge-path [State-6]  x=570.0 y=290.0  </editorLayout>
    </transition>
    <transition event="Proceed" target="State-7"/>
    <editorLayout>   node-size-and-position x=350.0 y=250.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-ca52f380-004b-4e40-8caa-9e28596099c9"/>
  </state>
  <state id="State-4" name="Rework" discontinued="false">
    <transition businessactionid="acn-90642959-a970-4c3c-a427-4025c92d457b" event="Submit" target="State-2">
      <editorLayout>   edge-path [State-2]  x=130.0 y=180.0  </editorLayout>
    </transition>
    <assignee id="PMDM.UG.Suppliers" type="group"/>
    <editorLayout>   node-size-and-position x=70.0 y=250.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-8497e634-b56d-4dff-9e2a-e9c053349016"/>
    <onexit businessactionid="acn-8ee4bfa0-2d1c-4a24-baa2-d2c83097653b"/>
  </state>
  <state id="State-5" name="Rejected" discontinued="false">
    <transition event="Remove" target="State-9">
      <editorLayout>   edge-path [State-9]  x=740.0 y=670.0  </editorLayout>
    </transition>
    <assignee id="PMDM.UG.Suppliers" type="group"/>
    <editorLayout>   node-size-and-position x=680.0 y=540.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-3b48a6c7-41ce-4d35-aef0-0e1893aa37c4"/>
    <onexit businessactionid="acn-7b272f60-6bd1-4b07-87b3-4c181c83bf74"/>
  </state>
  <state id="State-6" name="Waiting for Assets" discontinued="false">
    <transition businessactionid="acn-99f4e274-8802-45f3-b9b7-2b47c5073685" event="Submit" target="State-7">
      <editorLayout>   edge-path [State-7]  x=570.0 y=450.0  </editorLayout>
    </transition>
    <assignee id="PMDM.UG.Suppliers" type="group"/>
    <editorLayout>   node-size-and-position x=510.0 y=350.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-cae536f8-4628-4b82-9831-984c96d3afc6"/>
    <onexit businessactionid="acn-663663e2-cdce-420d-935d-1bbdd0944636"/>
  </state>
  <state id="State-7" name="Asset Approval" discontinued="false">
    <transition businessactionid="acn-6a9677d1-6932-4f1b-89ca-d476fc05a2e5" businessconditionid="con-4272bf7e-38bd-43a9-bfd0-5912a8d26a57" event="Proceed" target="State-8"/>
    <assignee id="PMDM.UG.ContentManagers" type="group"/>
    <editorLayout>   node-size-and-position x=350.0 y=430.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-1fe3c6c8-8719-4c06-a310-92b02dc9c9a2"/>
    <onexit businessactionid="acn-d72187c7-703d-4d92-be1a-f27a7a2a4378"/>
  </state>
  <state id="State-8" name="Automatic Forwarding" discontinued="false">
    <transition businessactionid="acn-7443e22a-3752-4c2f-91f9-0267e8e08695" event="Approved" target="State-9"/>
    <transition businessactionid="acn-0884151a-6ea2-4d36-b1d5-91a7be3c376a" event="Rework" target="State-4">
      <editorLayout>   edge-path [State-4]  x=130.0 y=570.0  </editorLayout>
    </transition>
    <transition businessactionid="acn-fe538420-f69a-40a3-8673-c23c73395e91" event="Waiting" target="State-6">
      <editorLayout>   edge-path [State-6]  x=660.0 y=570.0 x=660.0 y=370.0  </editorLayout>
    </transition>
    <editorLayout>   node-size-and-position x=350.0 y=550.0 w=120.0 h=40.0  </editorLayout>
    <onentry businessactionid="acn-9df6765e-f1dd-4a9a-8599-b2760193b1ec"/>
  </state>
</scxml>
<workflowViews>
  <restriction displaySequence="0" includeSubgroups="false">
    <mapping displaySequence="0" stateID="State-1" viewID="Supplier"/>
    <mapping displaySequence="1" stateID="State-2" viewID="Retailer"/>
    <mapping displaySequence="2" stateID="State-3" viewID="Retailer"/>
    <mapping displaySequence="3" stateID="State-4" viewID="Supplier"/>
    <mapping displaySequence="4" stateID="State-5" viewID="Supplier"/>
    <mapping displaySequence="5" stateID="State-6" viewID="Supplier"/>
    <mapping displaySequence="6" stateID="State-7" viewID="Retailer"/>
    <mapping displaySequence="7" stateID="State-8" viewID="Retailer"/>
  </restriction>
  <view id="Retailer" automaticSort="false" defaultSortColumn="0">
    <aspect id="id"/>
    <aspect id="name"/>
    <column name="Workflow Task" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowTaskColumn"/>
    </column>
    <column name="Assignee" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowAssignee">
        <parameter id="ExpandGroups" value="false"/>
      </plugin>
    </column>
    <column name="SupplierUserID" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="SupplierUserID"/>
      </plugin>
    </column>
    <column name="MessageToRetailer" mandatory="false" readOnly="true">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="MessageToRetailer"/>
      </plugin>
    </column>
    <column name="MessageToSupplier" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="MessageToSupplier"/>
      </plugin>
    </column>
    <column name="ProposalStatus" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="ProposalStatus"/>
      </plugin>
    </column>
    <column name="BuyerUserID" mandatory="false" readOnly="true">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="BuyerUserID"/>
      </plugin>
    </column>
    <column name="NewDataSource" mandatory="false" readOnly="true">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="IsNewOrUpdate"/>
      </plugin>
    </column>
    <column name="ContentManagerUserID" mandatory="false" readOnly="true">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="ContentManagerUserID"/>
      </plugin>
    </column>
  </view>
  <view id="Supplier" automaticSort="false" defaultSortColumn="0">
    <aspect id="id"/>
    <aspect id="name"/>
    <column name="Workflow Task" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowTaskColumn"/>
    </column>
    <column name="Assignee" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowAssignee">
        <parameter id="ExpandGroups" value="false"/>
      </plugin>
    </column>
    <column name="SupplierUserID" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="SupplierUserID"/>
      </plugin>
    </column>
    <column name="MessageToSupplier" mandatory="false" readOnly="true">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="MessageToSupplier"/>
      </plugin>
    </column>
    <column name="ProposalStatus" mandatory="false" readOnly="true">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="ProposalStatus"/>
      </plugin>
    </column>
    <column name="MessageToRetailer" mandatory="false" readOnly="false">
      <plugin pluginID="WorkflowVariable">
        <parameter id="Variable" value="MessageToRetailer"/>
      </plugin>
    </column>
  </view>
</workflowViews> -->
            <SetupGroupLink SetupGroupID="PMDM.WorkflowsExternal"></SetupGroupLink>
            <Name>Product Onboarding</Name>
            <MetaData>
                <MultiValue AttributeID="PMDM.AT.PDS.SupplierFacingStates">
                    <Value>Rework</Value>
                    <Value>Rejected</Value>
                    <Value>Waiting for Assets</Value>
                </MultiValue>
            </MetaData>
            <ValidUserTypeLink UserTypeID="PMDM.PRD.ExternalSourceRecord"></ValidUserTypeLink>
            <Configuration>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</Configuration>
            <LocalBusinessRule ID="acn-023fd610-97bb-45b6-8695-ca652300b4f7" Scope="Local" Type="Action" RunPrivileged="false"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-2");
var userID = workflowInstance.getSimpleVariable("BuyerUserID");

/* Assigns to a specific user (and not to the whole group) if the BuyerUserID is set */
if(userID) {
	var userObj = manager.getUserHome().getUserByID(userID);
	if (userObj) {
		task.reassign(userObj);
	}
}
  </javaScript>
</config>
Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);

instance.setSimpleVariable("ProposalStatus", "");
var supplierRejectValue = manager.getAttributeHome().getAttributeByID("PMDM.AT.ProposalStatus").getListOfValues().getListOfValuesValueByID("AP").getValue();
if (supplierRejectValue) {
	instance.setSimpleVariable("ProposalStatus", supplierRejectValue);
}

instance.setSimpleVariable("MessageToSupplier", "");
  </javaScript>
</config> -->
                <Name>Buyer Approval - OnEntry</Name>
                <Configuration>H4sIAAAAAAAAAO1WS0/bQBA+41+x8gEZVOy2p0p5oIQUlYqIiAQ4oo0zNgubXXcfpLTiv3cftuOURCmI9lI4BO83M983Ozs7dkF1Ttg1LgpKQF6T7DrlLCN5WxpAdQtv9linffh9TtE9CEk464Qf4vchApbyGWF5J7yYHB98Cg+7QbuvJWEg5bmm0A0QqoGRo0NNu4dOBp3wK77H41SQQlX2XqqM0BVRN33CZjK0XIZthAWegzJpeKAJIcvkvdHkoYBOeGtoY4pZHo+VMImG3V2qWis72f2muWqZ7fiH5Z782m3MPx7u5qoVWAKrMcSFWyNUIchUSgmcKpOGjzjSQgBTZ9NbSJV1OSo9Sq0eJViWvozPoITrDR1RLGu7ptQ/JVt1h5jhHMQWxbn3ei3RU55v16TO6bUky/pecXGXUb7Yor0o3Z6jbrWT5nG3kzpuQwN+FoKLoelgU9y/3YinPMWU/MBTCqXiBOYFxQr6ms0oJH+Y8/L6bU74Hgs0g6nOh6ZTUQcpoaEVBElyzEuDuct5HGSauavrsWgu8z3008mSDEU1QwXaP98V8QILZihcSMsZH4PHILDC1dmdMKkwS62+vTBxDvXpV6ao8jUcNlRheWfcf2ewoRNj6j+cDCJf17EyhTv46BdltJYgTgYb4sfEFBsusSD2BEqWvn4AceHCaqYg2Uc9KUnOJFIcYSQLSElGUsePImy6m3FlbeoG0OKGU0C54LrYs1WzWIMWEYkkKLSfBCSLfIa2nDtVwmbgmIzL+20TtXFf+ByivWrltl2GtoIdezRlpGPasVWLBWCXdG0ynvZInjRUA3BzuZ2sTv23F8F/9CJ4m8r/eCqT5w3FoPKP5YYRNhK84BJTOxC19Ng75P+vTEep3bejOAfb2JeYalgdPD1l8pxqBcvpU0ONyTsaDoZxbxKvE3ZBp0Sqs8wJyOgJ4n4bdL1RI9QZI5OwnXFrEnbz7oUlWUfXsu+srXxVY/BxSbG+yi+YtEvEf4KXX/O/AKbZ5E3tCwAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-0884151a-6ea2-4d36-b1d5-91a7be3c376a" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Returned

Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
var messageToSupplier = instance.getSimpleVariable("MessageToSupplier");
if (messageToSupplier) {
	PDSLib.PDSSupplierProcessNotes(node, "Rework: " + messageToSupplier, logger);
	
	/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
	allPackaging.toArray().forEach(
		function (packagingObject) {
			PDSLib.PDSSupplierProcessNotes(packagingObject, "Rework: " + messageToSupplier, logger);
		}
	);*/
}
  </javaScript>
</config> -->
                <Name>Automatic Forwarding - Rework - OnTransition</Name>
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAALVVTVPbMBA9279C4wPjUGq3tw75YBwIM3QIpAktx4xw1kagSK4sBSjDf+/KskNChpIy7c162t339kPrgpuciSktCs6gnLJsmkqRsbxTIqB7hbt2WLdzcD/nZAGqZFJ0g8/Rp4CASOWMibwbfL84/vglOOj5nb4pmYCyHBsOPZ+QJTCqwpHVewedHHWDMWSgMByc62tQ/aSxSlKNdIENhKFGVNE5aNTggFWIrIWZ9ZOAXDwU0A1u6IJGnIo8mmiFYoPeaHg0jPrjJBodTaJvBgwMFiB0NAZtlIBZJ15GrYnjdeZOvJ7U9nl+RTGTVLFCr2d4yfR1n4lZuXWqzvrVHHe4bq91bOenkbqNbXMfz71z56qB7vNgJ9dt3wawHENaVGdCGoTgRGhFU40ynMehUVh1fX51A6m2Joe1Rc2VcEbL2lbIGdTwMqFDTsvlveHcfcXb8l5KdZtxefcG811t9q/YT2We46z+mZRXRn9DaQnj1cpvjOPGLAyUkmqIw0Rz+N8zcSpTytkvesWhZryAecGphr4RMw7xlpqfX8LrghdUESZKTfFFky6xoxPlsOz3SX0VNp1ttX3rMq91yYmpVptC3yaM9Z8wFAw/qGI2i9BlOHzp5GAMyTISboRskUffw/1xyq7sGmngkZIpmp5JDWVo9e4RF2cMVuR+fSIfNkXuETcryOj5XrxrM6Gcj2h6S3F75JgEak9WkGMl54N7LKigvFknx0ZUCyWCBeUGuxI+bry7/aqST5ZolSDSMlGKPoStKJNqQNPr0Pe8rA5IwqIxdO+8qoD3Vg1eOL2vHN6T77Xau7H/9I7V/Iy4X1L9d/sNxT+hSP0GAAA=</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-1458ff20-89c8-4a46-8d7f-a3cd029bada9" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

/* Saves the current user in a workflow variable, to re-assign the task directly to him (and not to the whole group) if need be. */
var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-1");
var assigneeID = task.getAssignee().getID();
workflowInstance.setSimpleVariable("SupplierUserID", assigneeID);
debug("Task assignee (SupplierUserID) = " + assigneeID);
  </javaScript>
</config> -->
                <Name>Proposal - OnExit</Name>
                <Configuration>H4sIAAAAAAAAALVVW0/bMBR+z684ygNKGSTjbVKbIkqH1IlqaC3jEbnJaWpw7cx22rGJ/77jOAmtEOomsTzF37l852qXoiq4vGdlKTiae768z5Rc8mJgCLDD0os9lg7Of64FbFAbrmQansUfQ0CZqZzLIg1v51enn8LzYTAYVYZLNOZbJXAYAHTATe0OduUemozT8AvbsFmmeWlb+UVmieiO29WIy9yEzhd5u2GardFSGB7YhcB58towfyoxDR/IbSyYLOKZ1RRoODwStr+XydGPStk+peN/XnLy5zox/3t+VNh+4Bw4jikr6zNAiwBVymqWWQrDW1xWWqO0XxcPmFmnctloNFwXgjPT6EqVYwN3CV0KZjp5JYT/Sw7yTplkBeoDjGuv9V6k16o4zClqpfeibOp7p/TjUqjtAe5to/Yv7I472W33IOns3hjAz1orPaUJpuL+70G8VhkT/BdbCGwY57guBbM4qmQuMPnLmF/W7+2AN0xDjouqmNKkQgpWV9gPgiS5Uo2AdrmIg2Ul69X1WLQ2RQ9+17R8CVHnoQXd56ci3jItyUVt0q+Fz8EzMRzDjG3QgF0hZL7lUBkKna4TBm1bgQLkrhInYBVoPKWu8kLWVpaZR8i5pjUUT0684muIGM2UVNadndJ2pQRCoVVV9lysEjGHBcZwnAQu+ZZoIo1lMnM1cEsbF9hNYCuKWl3Kw5nW/OkrD850TqLR02Qc+d7OLDXv9MwfGmufCOJk7MpO+s7uogGjnjuRPSm/8m/QzjgNBH5vatOyVPWdr2+pipOxx052eMiX754XuRg7KUT71j0KqhnZD3suXo3dDlDf3oNk/22g1yPZfz6al+gPk25gn6kGAAA=</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-1fe3c6c8-8719-4c06-a310-92b02dc9c9a2" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-7");
var userID = workflowInstance.getSimpleVariable("ContentManagerUserID");

/* Assigns to a specific user (and not to the whole group) if the BuyerUserID is set */
if(userID) {
	var userObj = manager.getUserHome().getUserByID(userID);
	if (userObj) {
		task.reassign(userObj);
	}
}
  </javaScript>
</config>
Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);

instance.setSimpleVariable("ProposalStatus", "");
var supplierRejectValue = manager.getAttributeHome().getAttributeByID("PMDM.AT.ProposalStatus").getListOfValues().getListOfValuesValueByID("AP").getValue();
if (supplierRejectValue) {
	instance.setSimpleVariable("ProposalStatus", supplierRejectValue);
}

instance.setSimpleVariable("MessageToSupplier", "");
  </javaScript>
</config> -->
                <Name>Asset Approval - OnEntry</Name>
                <Configuration>H4sIAAAAAAAAAO1WW0/bMBR+Jr/CygMKaCTb0yb1glq6aZ2oqGiBR+Smp8Hg2pkvdGziv8+3pO1o1YGY9gIPJTmX7zs+Pv6ckuqCsGtclpSAvCaz65yzGSma0hhUu/Rub2s1j3/MKboHIQlnrfhD+j5GwHI+JaxoxRfjL0ef4uN21OxqSRhIea4ptCOEasPQwaFVvzf1e634G77Ho1yQUlX+Tq4M0RVRN13CpjK2WAZtiAWegzJleMOqCVkkH43GDyW04lsDm1LMinSkhCk0bu9T1Vhbyf53zVXDLMc/LNfk393C/OPxfqEakQWwHANcuneEKgsynVIC58qU4TNOtBDA1NnkFnJlQ05CRODqUIJliGV8CsFcL+iEYln7NaX+KdvJe8qLAsQOQuqCXotygBnezTn3Ua9FGvp7xcXdjPLFDvJFCHsOu+XOVre7mdV5WwbwsxBcDMwEm5X+60E85Tmm5CeeUAiMY5iXFCvoajalkP1lzcvjt73geyzQFCa6GJhJRS2khIZGFGXZFx4c5iwXaTTTzB1db0vmsjhAvxwtmaGkRqiM9s+PYrrAghkIl9JwzsfoMYoscbV3fSYVZrnltwcmLaDe/cqVVLEGw6YqLO9M+J8INnVsXN2Hfi/xfR0p07ijj/4lZGsJot/bkj8iptlwiQWxOxBQ7ASaoQwH4sLl15BRdog6UpKCSaQ4wkiWkJMZyR0RSrAZc8aV9akbQIsbTgEVguvywLbP2rr6oYJFRCIJCh1mEZklvlTb172qcqM8pvRw6mzFNu8rn0NyUL259YfURrRn9yhkOqQ9275UAHZF1y4TafbmyWCtGJw+N7N19X+7EP7PhfCmzs9U59eTTPI8xYqq+FRu0Zeh4CWXmFq10tLb3iH/f026pHYfduIc7LRdYqphXQw6ytQ50QqWilCbVmRxOOgN0s443UTskk6JVGczRyCTJxb3uwLXGa6kOmdiCra6s6Fgp0EvbMkmuIa9UHbiVXcpHwWIzV1+gfwtLf77OHxq/wZR5s0IigsAAA==</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-3b48a6c7-41ce-4d35-aef0-0e1893aa37c4" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

function getSingleValueLovID(product, attributeID) {
	var value = product.getValue(attributeID);
	if (value) {
		return value.getID();
	}
	return null;
}

// System Messages are stored on entities, for localization purpose.
var msg1 = manager.getEntityHome().getEntityByID("SysMsg_AutomaticallyProceeded").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Automatically proceeded

var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-5");

var userID = workflowInstance.getSimpleVariable("SupplierUserID");

// Reassigns the task to the previous assignee, if there was one.
if(userID) {
	var userObj = manager.getUserHome().getUserByID(userID);
	if (userObj) {
		task.reassign(userObj);
	}
}

var processedBy = getSingleValueLovID(node, "PMDM.AT.ProcessedBy");
// If onboarded via PDS or GDSN: Proceed in workflow and move product to "Rejected Products"
if (processedBy && (processedBy.equals("PDS") || processedBy.equals("GDSN"))) {
	task.triggerLaterByID("Remove", msg1); // "Automatically proceeded"
	
	if (rejectedProductFolder) {
		node.setParent(rejectedProductFolder);
	}
}
  </javaScript>
</config>
Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
instance.setSimpleVariable("MessageToRetailer", "");
  </javaScript>
</config> -->
                <Name>Rejected - OnEntry</Name>
                <Configuration>H4sIAAAAAAAAAO1X3U4jNxS+Zp7CygUKEjtTLipVDQEBWdpUpEUEyiVyZk5mveuxZ21PaNrlXfIsebKeY3vysyWlrVj1ZrlA4/P7nV87tWxKoR54XUsB9kFMH3KtpqI8tkhwJ3VgB1r/+PS3SrIZGCu06neO0m86DFSuC6HKfufu9vLNd53Tk+T4vLFCgbU3jYSThLEV4dqbY5v8QBoO+p2f+IyPcyNq1/LPcoeO7oV7dy5UYTtkC61dc8MrcAgjEDZJjCwFaXY7r6HfeY9mU8lVmY6dQaCdk33peluR7H9stOthOOFjHVM4+8DC5+l+6XoJGSAfI177M2MthWGmnOG5QxhB46IxBpT7ZfIeckciF1Ei+jqTgtsoq3QBkbwK6EJyu+I3Uoav7EW/V7oswbzgUHqh13I54oq/7LMKUq/lNOb3XpsPU6kfX3D+GMVey/u10UXzYl0NUPGhiNKXWhZ/n4BcV6l1YqLTXBtIC11xoVJR1TK9NOgnGhoiISgQ0Jvo5U5dcHcFM5BHBDwjcKu2zTb79jhbed8xSW+N0WaEo4gl+9ITdaVzLsXvfCIherwFDJA7OG9UISH7h5jXe2Q34Bk3rIBJU45w5FifOdNAL0my7FJHBi6lMk2mjfI7KNC6lS0P2B/erZiy7spCS6S/MFPpIzcKTXiVnmc+JU/J2mAJbox8Cb9y2cCVng0H3TqU9ZBxhzgnjYPhgEzvEdwZySHUKJSiAa/a3RTuJXsEzMt6zT0DrjEqaJMOuiGpp6TlULv3CFqWLRfjuXVQLRdtyZcLbmC5sA7bsFgutFoucNiEw7vicLmYarNcyFg2imq5qBtTawtpQpAx9iNEHCeevL8l5fmPuoLuwfp8PkdUoR0QwMiWD2eNw553Ak3LOXZ7DlBAEUQO1qHHIRwNRunZbRrAR+gbsmManJBnjJ1lGdsyTxkN9hOPut0RQ2UdVznlnBYzWbr/jNVtZTGlpOq4/YDin1sg1VtkbcbpsK/ffBtR9oLnxoIZDnYYaKMwgiakNdP4i9vcec21NYzxBnCfiFJZ5t5BQOa0/64NzIRuLAsCAIfUzcgxwB65ZVph/cS0G+CsGpCOeI1tF5Qcr8tJJx9kVI3tGDVDQxKS1ERwK5ZvyaeQBl8Pa6E4n6Oz5waF6nHItqt/vdZa5QHTMJxiPBPNDdaXzQRn14MxwyH/YTD++XsWW4vho6TNOeO46Cs9g3bSKG3BYrthWdy/NpATinET9D6v6p7/t0VP4WPDpW27djCOONmnT2ynGOGMcgc+gT5/OPG0Za6wicxGV90AAQ/fh378Qr8Hyo6uj0HshVo9e1eFyvkpsOBw3eIS2CEZCvmXLb1B8K+242z7Tfj1mfj/PBO//PPp66tj69Uh/t2t0orT3D17A7Sg9Q04LmT7rmy3Y7sK/8NArinhd1z8SfgnesbOCTIOAAA=</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-47465974-ece8-46ba-9e18-9021f1774dab" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Returned

Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
var messageToSupplier = instance.getSimpleVariable("MessageToSupplier");
if (messageToSupplier) {
	PDSLib.PDSSupplierProcessNotes(node, "Waiting for Assets: " + messageToSupplier, logger);
	
	/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
	allPackaging.toArray().forEach(
		function (packagingObject) {
			PDSLib.PDSSupplierProcessNotes(packagingObject, "Waiting for Assets: " + messageToSupplier, logger);
		}
	);*/
}
  </javaScript>
</config> -->
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAALVVy1LbMBRd21+h8YJxKLXbXYfEYRwIM3QIpAltlhnhXBuBIrl6BCjDv1ey7DzIUNLXTj6695z70nVJdUHYFJclJSCnJJ9mnOWk6EgDqG7prh2WdI4e5hQtQEjCWRJ8jD4ECFjGZ4QVSfD16vT9p+Co63d6WhIGUo40ha6P0BIYVnRo/d5BZydJMIIchKGDS3UDopc2VmmmjFxgiQzVEAs8B2VicMA6hDZoZr00QFePJSTBLV7giGJWRGMlTLBBdzg4GUS9URoNT8bRFw0a+gtgKhqB0oLBrBMvWWvheFO5E28mtXuen00w40yQUm1mOCHqpkfYTO6cqrN+Ncc9qtobHdv7rrlqm7a5w6p37rtqoDse7RWq7VsCqzHAZfWNUIMgMxFK4EyZMJzHsRam6ury+hYyZU2Oa4taK6UEy9qW8RnU8DKhY4rl8l5T6k7xrroTLu5yyu/fUL6vzf6V+jkvCjOrvxalldHvSFrBeL3yW+O4NQt9IbgYmGHCBfzvmTjnGabkB76mUCtewbykWEFPsxmFeMeYVy/h9YAXWCDCpMLmRaME2dGJClj2+6y+CpvOttq+dZnXcfGxrlabML4NjfUfExMwfMOC2CxCl+HgpZODDSXJUbhF2UJPvmf2xzm5tmukgYeCZ8b0giuQoY33ADmeCSbK5IRyLlAqJSh5WN+gd9sBHyA3N0bd871432aFKR3i7A4XliZBJo90DTkVfN5/MMVlmDar5VSzarlEsMBUmw6FT1tv8LCq6rMVWheIFE+FwI9hKzIR93F2E/qel9eEKCwbQ/fmq2p4b9XjhdPfl8Z79r1Wez/2n/9gZa8Q96uq/3o/ASSC058VBwAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-4f301fc8-3ad8-43be-828e-2c8c21adb705" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

/* Saves the current assignee to workflow variable BuyerUserID, so that the person who was in charge can continue with the maintenance of this record */
var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-2");
var assigneeID = task.getAssignee().getID();
workflowInstance.setSimpleVariable("BuyerUserID", assigneeID);
debug("Task assignee (BuyerUserID) = " + assigneeID);
  </javaScript>
</config> -->
                <Name>Buyer Approval - OnExit</Name>
                <Configuration>H4sIAAAAAAAAALVVTU8bMRC9768Y7QEFCtm2p0rJBhFSpFSgoiaUI3I2E8fg2Fvbm5RW/PeO196wKUJppTan9Zt58+bLTikrLtQdK0sp0N6JxV2h1ULwviXADcpgDljeP/2+krBGY4VWefqu+zYFVIWeC8Xz9GZ6cfIhPR0k/WFlhUJrv1QSBwnAFriuw0HbHqDxKE8/sTWbFEaUrrGfFY6EboVbDoWa29THomjXzLAVOkojAG0IfKTgDdPHEvP0nsJ2JVO8O3GGEk0HB9L1dio5+FZp16NywsdzTeFcFxY+Tw+46yU+gNe4YmV9BmgQoE45wwpHaQTGeWUMKvd5do+F8y7n0SNqnUnBbPRVeo4R3hZ0Lpnd2ispw1e2V/dSc45mj6Csnf6VZCz1VpuHhdSbPdqb6PY36l47a3e+n215r+zCR2O0uaJlYhz/905c6oJJ8YPNJEbFKa5KyRwOKzWXmP1hzs834fWE18zAHGcVv6KlgRycqbCXJFl2oaOBrhXvJotK1bcoYJ2V5Yfws5YVC+hsIzSg/4Wt6G6YURSipvRq41PyRApHMGFrtOCWCEUYOdDIBFeI4DQ0gwVKUfhe0H1/RHNj0YxHx2A1MZmr6SU1m1LbLInFLNDTUCyZ4RSXqXq/hKoQNvQA1O4rJpRDxVSBoBcECQsGC23mcJQlviON9lhZV7vl4C9Vl+N2LRtTp/Gl4jzVMftA7r9H8NQpmYaP41EnDHziaKIn78MhspsGjEd+FuTveWcR7Bz6E/HJ+UV8i24iaEvwa2xXVGk1LQDHLREKFOYZTD7B5xl0WtRDSidu8Jsd/ostbAH1u9rPdl9tetez3Yc9/kf8AoFjckxDBgAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-578ca828-bbbd-48c7-ae4f-3d60881806b4" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
/* Set the ID of who rejected, reworked, or approved, and when.*/
var userID = manager.getCurrentUser().getID();

var date = new Date();
var formatter = new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
var isoDate = formatter.format(date);

var workflowInstance = node.getWorkflowInstance(workflow);
var isNewOrUpdate = workflowInstance.getSimpleVariable("IsNewOrUpdate");
//var proposalStatus = workflowInstance.getSimpleVariable("ProposalStatus");
var proposalStatusID = workflowInstance.getValue("PMDM.AT.ProposalStatus").getID();

if (isNewOrUpdate && isNewOrUpdate.equals("New")) {

	if (proposalStatusID && proposalStatusID.equals("RJ")) { // Reject
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("RJ");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}

	if (proposalStatusID && proposalStatusID.equals("RW")) { // Rework
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("RW");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);	
	}
	
	if (proposalStatusID && proposalStatusID.equals("AP")) { // Approved
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("AP");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}
	if (proposalStatusID && proposalStatusID.equals("WA")) { // Waiting for Assets
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("WA");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}
}

if (isNewOrUpdate && isNewOrUpdate.equals("Update")) {

	if (proposalStatusID && proposalStatusID.equals("RJ")) { // Reject
		node.getValue("PMDM.AT.UpdateApprovalBuyerStatus").setLOVValueByID("RJ");
		node.getValue("PMDM.AT.UpdateApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.UpdateApprovalBuyerDate").setSimpleValue(isoDate);
	}
	
	if (proposalStatusID && proposalStatusID.equals("RW")) { // Rework
		node.getValue("PMDM.AT.UpdateApprovalBuyerStatus").setLOVValueByID("RW");
		node.getValue("PMDM.AT.UpdateApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.UpdateApprovalBuyerDate").setSimpleValue(isoDate);	
	}
	
	if (proposalStatusID && proposalStatusID.equals("AP")) { // Approved
		node.getValue("PMDM.AT.UpdateApprovalBuyerStatus").setLOVValueByID("AP");
		node.getValue("PMDM.AT.UpdateApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.UpdateApprovalBuyerDate").setSimpleValue(isoDate);	
	}
	if (proposalStatusID && proposalStatusID.equals("WA")) { // Waiting for Assets
		node.getValue("PMDM.AT.UpdateApprovalBuyerStatus").setLOVValueByID("WA");
		node.getValue("PMDM.AT.UpdateApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.UpdateApprovalBuyerDate").setSimpleValue(isoDate);	
	}
}

/*
 * Forward the EXT from the vendor enrichment state.
 */
/*var workflowID = workflow.getID();
if (node.isInState(workflowID, "Enrichment")) {
	var task = workflowInstance.getTaskByID("Enrichment");
	task.triggerLaterByID("Submit", "Automatically forwarded");
}*/
  </javaScript>
</config> -->
                <Name>Buyer Approval - Proceed - OnTransition</Name>
                <Configuration>H4sIAAAAAAAAANVYW3PaOhB+xr9Cw0OGMI19+tYpl4wJ6ZROaDKBhPOWUbAAtbLkSjKUdvLfz0oyxibJCSVlkvDAyHv5dveT5J11wtIp5Tc4SRgl6oZObsaCT+i0qUCg24lTO1mrefwzZmhOpKKCt6rv/X+qiPCxiCiftqpXw09HH6rHba/ZSRXlRKnLlJG2h1AuuLBwqKh3ol63Vf2C53gwljTRK3041hBoRPWsQ3mkqgYL0C6wxDHRkIYTFEXIIDlrNFwmpFX9BrA+w3zqD7SERKvtA6YbpUoOfqRCN6Act1jX5J5tYW55fDDVDc8AmBh9nNhnhFYSBExpicca0nAeJ6mUhOvz229krI3JSWaRxQoZxSqz5SIimTgv6IRhletTxtwqeDJuH3M8JfKJiLGz+ltBs2JHQn6fMLF4IvgiM/uT6CZ2UOS+GeR+j5yGUymF7MNxgkr3fSrOxBgz+gvfMpJFHJI4YViTTsojRoItc17fhccTDupoQDTSMwIuSEzQYiaQJOackegdrAy/ZiUkgvstxdw8YNi3xYxwvx54cyxRqogE9xbKjoI/JTrbxitQ1Q6NoNetHTY8ax9BLWDNyQJ1YWnkRjwRMsbapO90Nl1Nfmp/QIEAYmw/WZua42wJv6N+/yiK0OfPH+P4o1JOkQFSJbouVA7tu1XNpLBKZ3WGelxpzMc2NbhFJunRhqq2ss0jfCWLc3mVZCVtQhkMl/w1ltRsaZZ6r+iYJx0EBhRoToTCbKCxTtWfoF6UPEtclEHtbj0Ee41ZmqP1u30/HPoPoha2lE5QrUzEAY6Thv0rM+STHylmKsMHRQZ2iH57XsXg3EuzALWpK6NdflmDoSBAl/YUe5XKai//r7TQnm3MOumSyHKdiuiz82vr3FlCxRvRGrtEuLIXphBhtZvG392m3YC769O0CZtdBoN793yyR5tkm8O0N7JHb5bsimG78ly6w4sy3WH2Kt4X4Xm8t0e45ft5bI/CMtsjTDV0S9NEUKggsNoX73nkt8n73e69oNQIX6wduCz21wwewP8bm/YA7NZX5UU6wa48b9sHXhfPL9oDdqR66w7wGql+4df/jpRv/fJ/hZTDmz+oe6iOYD5bYBnZifL03yGaSBHbhznhERBIuKTjWQyTIYKhA7oAOAXgW5rDisPJes4wu2rzp6rHDaHraazXfYdcnqc5fqGXVAy6xur7I0PPEFSFjbiHAcwZbx+G5imMt2cQWhbsB+ltTDPbVR5hqgXMmRRGebY0R8ewQqIc8K4e3JvgCwL7VaoZlL95tb21xH0Wy76w/QfPY13NgRMAAA==</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-663663e2-cdce-420d-935d-1bbdd0944636" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}
 
var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-6");
var assigneeID = task.getAssignee().getID();
workflowInstance.setSimpleVariable("SupplierUserID", assigneeID);
debug("Task assignee (SupplierUserID) = " + assigneeID);
  </javaScript>
</config> -->
                <Configuration>H4sIAAAAAAAAALVVXW/aMBR9z6+w8oCCtibbyzQJAuJjlZiKVg26PiITLp5bY2e2Q9dO/e+7jp0UVlVsUsdTfO6959wvm1JUjMsVLUvBwaz4dlUoueWsbxCwg9KbPZb3hz93guxBG65kHr9P38UEZKE2XLI8vlqen32Mh4OoP64Ml2DM10rAICKkBS5rOnJo99Bsmsef6Z4uCs1L29hHhUWha26/j7ncmNhxIdsl1XQHFtPwwCFEHJP3Jsv7EvL4BmlTQSVLF1ZjovGgI2zvqJLOj0rZHpbjP55q8ue6MP857DDbixyB05jTsj4T0iAEO2U1LSym4SMmldYg7Zf1DRTWuUyCR9AaCU5N8JVqAwFuC5oIalp7JYT/yk7qzqmkDPQJxZ33ei3RC8VOa4ra6bUkQ3+vlb7dCnV3QvsuuP2LutPODsfdz9q4Fxbwk9ZKz3GDsbn/exEvVEEFf6BrAUFxCbtSUAvjSm4EZH+Z89P1eznhPdVkA+uKzXFTSU6srqAXRVl2roIB7zJLo20l66vrsWRnWJf8qmX5liQtQwO6n9+K9I5qiRR1SK82PkaPEYmccjO8mTSWysIl4G5MyqAdf2NKGl8kcaGWmlt0/5PBhS7RNL6fTRPf2IXFzp198IcQjbvBmQSYTV3N6O/iRgFMuu6E8ej8jN+AXXCcBnyjmrsRNSpV/eDqKwN6NvXY2wMd5PKt8yaXY2slyXF0F5MK+/LmiOLZzA+A+unsZ8cPMz7d2fHbHf4GfgMzHsVkJgYAAA==</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-6a9677d1-6932-4f1b-89ca-d476fc05a2e5" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
/* Set the ID of who rejected, reworked, or approved, and when.*/
var userID = manager.getCurrentUser().getID();
logger.warning("Asset transition t1");

var date = new Date();
var formatter = new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
var isoDate = formatter.format(date);

var workflowInstance = node.getWorkflowInstance(workflow);
var isNewOrUpdate = workflowInstance.getSimpleVariable("IsNewOrUpdate");
//var proposalStatus = workflowInstance.getSimpleVariable("ProposalStatus");
var proposalStatusID = workflowInstance.getValue("PMDM.AT.ProposalStatus").getID();

if (isNewOrUpdate && isNewOrUpdate.equals("New")) {

	if (proposalStatusID && proposalStatusID.equals("RJ")) { // Reject
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("RJ");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}

	if (proposalStatusID && proposalStatusID.equals("RW")) { // Rework
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("RW");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);	
	}
	
	if (proposalStatusID && proposalStatusID.equals("AP")) { // Approved
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("AP");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}
	if (proposalStatusID && proposalStatusID.equals("WA")) { // Waiting for Assets
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("WA");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}
}

if (isNewOrUpdate && isNewOrUpdate.equals("Update")) {

	if (proposalStatusID && proposalStatusID.equals("RJ")) { // Reject
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("RJ");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}

	if (proposalStatusID && proposalStatusID.equals("RW")) { // Rework
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("RW");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);	
	}
	
	if (proposalStatusID && proposalStatusID.equals("AP")) { // Approved
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("AP");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}
	if (proposalStatusID && proposalStatusID.equals("WA")) { // Waiting for Assets
		node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").setLOVValueByID("WA");
		node.getValue("PMDM.AT.ProposalApprovalBuyerUserID").setSimpleValue(userID);
		node.getValue("PMDM.AT.ProposalApprovalBuyerDate").setSimpleValue(isoDate);
	}
}
logger.warning("Asset transition t2");
/*
 * Forward the EXT from the vendor enrichment state.
 */
/*var workflowID = workflow.getID();
if (node.isInState(workflowID, "Enrichment")) {
	var task = workflowInstance.getTaskByID("Enrichment");
	task.triggerLaterByID("Submit", "Automatically forwarded");
}*/
  </javaScript>
</config> -->
                <Name>Asset Approval - Proceed - OnTransition</Name>
                <Configuration>H4sIAAAAAAAAAO1Y3U8bORB/zv4VVh5QiMru9Z6q5gNtCFVTkYJIIPeGzK6TuPXaW9ubkDvxv9/Y3uxHKEcLxwNSeEDe8cxvZn4eZzROWbag/AanKaNE3dD5TST4nC66CgS6n7ptJ+t1j+8ShlZEKip4r/ne/6OJCI9ETPmi17yafjr60Dzue91BpignSl1mjPQ9hArBhYVD1X0nGg17zS94hSeRpKne7oeRBkczqpcDymPVNFiAdoElToiGMJygKkIGyWmj6SYlveY3gPUZ5gt/oiUE2uwfMN2pZXLwIxO6A+m4RZmT+7aJueXxwUJ3PANgfIxxar8R2koQMKUljjSE4SxOMikJ1+e330ikjcpJrpH7ChnFKtflIia5uEjohGFV7GeMuVXwpN8x5nhB5BMeE6f1fznNk50J+X3OxPoJ5+tc7Xe8G99BlftuUNg9Ug2nUgo5hnKCTF+7Ks5EhBn9G98yknuckiRlWJNBxmNGgl+MubwLjwcctNGEaKSXBEyQmKP1UiBJTJ2R+B2sDL9mJSSC+y3FynxgOLf1knC/HXgrLFGmiATzHspLwV8QnR/jFWy1Do1gNGwddjwmFkZhjSWHAFou91ApE4TEXFFzW5F+7zbAwDqIIXmA52SNhrA0QEY8FzLB2uTr9mx+mtxpf0KBMWJ0P1md3NEG/o7G46M4Rp8/f0ySj0oVjgwgVWLoXBXQvlu1TAjbcLZFN+JKYx7Z0ODamSxnO1utrW7h4StZn8urNE9pF8pguOCvsaSmBvLQR1XDIuggMKBwLqlQmE001pn6HdSLmmWNizqoPd6fwV5jlhVo4+HYD6f+T1HLGvDoHLXqRBzgJO3Yf3WGfPIjw0zl+LCRgx2ifzyvYXAehFmB2t2ro11+KcFQEKBLW/Zeo7E9y/9KLbSXAbNBtiGynifU8tn5tTUebCDjHW+d53i4sjes4mF7msbeXb/nAQ/LatqFzS+Dwb1/OdmzXbJNMb0a2bM3S3bDsN14Kd3hRZ3uMP/tfi3CC39vj3DL98vYnoV1tmcY2hhfmCaCbG9Tr8V74flt8n7//F5Qa4T7drBvB/t2sG8H+3bwpnm//9Xx8M9yAGp7qI1gyAOT2M6xp39N0VyKxH6sCI+BdcIljZYJzKMIJhdoJWAUgG1tmKtOOOWwYkrBJkzViJszKEe60fAdcoGcFviVhtQw6Bqr749MTlPYqpzdAwygxFj7MKobUs7AtazoT7LbhOa62zjCTAsYVmmEGduYejOskLgAvG8HD94NKgL7FtYN6i9tfa+UuMe4/F3vX8ec+gf3EwAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-7443e22a-3752-4c2f-91f9-0267e8e08695" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.ApproveExternalAndPackaging

Action #2 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Accepted

Action #3 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
PDSLib.PDSSupplierProcessNotes(node, "Product Accepted", logger);

/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
allPackaging.toArray().forEach(
	function (packagingObject) {
		PDSLib.PDSSupplierProcessNotes(packagingObject, "Packaging object Accepted", logger);
	}
);*/
  </javaScript>
</config> -->
                <Name>Automatic Forwarding - Approved - OnTransition</Name>
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAAM1VXW/aMBR9Jr/CygOCqku2t2kQUMKHtKm0GTDtERnnEtwZO3PsqF3V/z4nDgGG+rFJlfZmH1/fc499rp0xnVK+wlnGKOQrulkRwTc07ecGUIPMLlss6A/vdgwVIHMqeOB+8N67CDgRCeVp4H5bTt99dIcDpx/pnHLI87lmMHAQaoC4SoeO1y30eRy4c9iANOngRm1BRuE+KiTK0LllIpMqxhLvQJkaLHAMoZM0SRS6aHmfQeDe4gJ7DPPUWyhpinUH8Ww886J56IVZJkUBkzuzn2MW8iTG5Ac2NaV9v8lck/un7H3/VNj/rjUeL7yvGjRMCuDKCwmBTEHyhjq/mGIWRNJMnSr8TtU2ojzJXy3VRj+psc1U78Sd7Z9aqJ6xqB0cfGrnlVntcNhOVc8pE5QcM5xVc4T2CDLuVxITZcqwO0ZamlNXN+tbIKoMGdURNVfIKM7rWC4SqOFG0IjhvFnXjNmR/yLvlUhT45bnCVkV9DeUJaF/rP3MEGe3MZFSyJm5TpzCW9/KlSCY0V94zaBmXMIuY1hBpHnCwH9lzQcvPtMq48UVXZeNstDVkyhjKYhhvRYK8k55mZfIFmgWEk0U2neRRS+RPf9uz3H8iwJLhBlrXhQUoBRUeIRMpdjt3559i0w1r5rEgwIzbXR2Hs689AmVk0dDc5zfUyKUEt93ut5GyAkm247T2tTpUCfbx1nndtGD02q9IPmPPY36RpKo8KePofXodHsX/j88MgfEfiT1n/QbLVSIZrMGAAA=</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-7b272f60-6bd1-4b07-87b3-4c181c83bf74" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

/* Saves the current assignee in a workflow variable, in order to re-assign it directly to him (and not the whole group) if need be. */
var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-5");
var assigneeID = task.getAssignee().getID();
workflowInstance.setSimpleVariable("SupplierUserID", assigneeID);
debug("Task assignee (SupplierUserID) = " + assigneeID);
  </javaScript>
</config> -->
                <Name>Rejected - OnExit</Name>
                <Configuration>H4sIAAAAAAAAALVV30/bMBB+z19xygNKGSTbw6RJ/YEoHVIn0NBaxiNyk6trcO3Mdlq6if995zgp7RCCSVuf4u/uvu/ufOeWsuJC3bKylALtrZjf5lrNBe9ZAtygDOaA9XsnD0sJKzRWaNWPP6TvY0CV60Io3o+vp+fHn+KTQdQbVlYotPZbJXEQAWyBq5oOdu0BGo/68Re2YpPciNK19tPckdCNcIuhUIWNPRexXTHDlugojQDsQuCZgjdMNyX24zuiTSVTPJ04Q4nGgwPpunuVHPyotOtSOeHjqaZwrgsLnycH3HUjT+A1LllZnwFaBKhTzrDcURoh4qwyBpX7OrvD3HmXs8aj0TqVgtnGV+kCG3hb0JlkdmuvpAxf2Vt1b7S5n0u9fkV53bj9K/ULzTmaV0Rl7fQ3kl4w2+18L9vGvTALn43R5pKGiXH83zNxoXMmxU82k9goTnFZSuZwWKlCYvbGnJ824eWEV8xAgbOKX9LQQB+cqbAbRVl2rhsDrRVPo3ml6i0KWLK0vAO/alkxh2TL0IL+F+4lXTOjiKIO6dbGx+iRFA5hwlZowS0Q8jBlQFcmuEIE2m4G7TQBJSl8N448rk1B9TkNBo+DPwgHhTC0GHLjDQuxhITRPCntavr1QksEbnRVdny+pFDADFM4zCLfgFZorKxjKvd98DuUctwOfmtKWl+qxYc6Zu/J/U8GHzol03AzHiXhfieOLvD4Yzg00W2945FvPfn7uNMGTDr+RPHk/IzfopsIGgr83vSmVanqJ9hcWzTjUcCOdnSIK9xgMPkcn7qe7Ed3KKlmbN/tUTwbvR2gfkx72f5TTY95tv+aN38MvwH51hOpOAYAAA==</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-819f91fe-0c4d-4783-baa3-5b423900fcff" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Rejected

Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
var messageToSupplier = instance.getSimpleVariable("MessageToSupplier");
if (messageToSupplier) {
	PDSLib.PDSSupplierProcessNotes(node, "Rejected: " + messageToSupplier, logger);
	
	/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
	allPackaging.toArray().forEach(
		function (packagingObject) {
			PDSLib.PDSSupplierProcessNotes(packagingObject, "Rejected: " + messageToSupplier, logger);
		}
	);*/
}
  </javaScript>
</config> -->
                <Name>Automatic Forwarding - Rejected - OnTransition</Name>
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAALVVTVPbMBA9279C40PGodRubx3ywTiQzNAhkCa0HDOKs3YEiuTKcoAy/PeuLDskZCgp096sp9339kvrjBcpE1OaZZxBPmXJNJYiYWk7R0B3M3ttsU77+H7JyQpUzqToeJ+DTx4BEcs5E2nH+341+PjFO+667V6RMwF5Pi44dF1C1sCopCOb9xY6O+14Y0hAIR1c6gWoXlRbRbFGOc8QIdWIKroEjTFYYBMiWzTzXuSRq4cMOt4NXdGAU5EGE60wWK87Gp4Og944Ckank+BbAQX0VyB0MIYbiDXM2+GatRIOt5Xb4XZS++f5FYOZxIplejvDa6YXPSbm+d6pWutXc2xw3drqWONnIXUL22Y/nntnz2UD7edxI9Ut1xAYjSHNyjMhNUJwIrSiscYwrMdJobDq+nJm6mdMTiqLSivijOaVrZBzqOB1Qiec5uv7gnP7Fe6rey3VbcLl3RvKd5XZv1I/l2mKs/pnUV4a/Y2kEQw3K78zjjuz0FdKqiEOE03hf8/EuYwpZ7/ojEOleAXLjFMNvULMOYR7xvz8El4PeEUVYSLXFF806RAzOkEK636fVVd+3dlmyzUuyyouOSnK1abQt6Yx/hOGAcMPqpjJwrcZDl86WRgpWUL8HcomeXQd3B/nbGbWSA2PlIzR9EJqyH0T7yGxPPVuOarO5MNumIfETgtqOq4THphcKOcjGt9S3B8ppoHRRxvIQMll/x5LKiivF8qgEOVKCWBFeYF98R93Xt5RWcsnI7QpEGgZKUUf/GaQSNWn8cJ3HSepCImf1Yb2pZc1cN6qwgun9xbEeXKdZusgdJ/esZ6fEftbqv5wvwF00UwvAQcAAA==</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-8497e634-b56d-4dff-9e2a-e9c053349016" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-4");
var userID = workflowInstance.getSimpleVariable("SupplierUserID");

if(userID) {
	var userObj = manager.getUserHome().getUserByID(userID);
	if (userObj) {
		task.reassign(userObj);
	}
}
  </javaScript>
</config>
Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
instance.setSimpleVariable("MessageToRetailer", "");
  </javaScript>
</config> -->
                <Name>Rework - OnEntry</Name>
                <Configuration>H4sIAAAAAAAAAO1W3W/aMBB/Jn+FlQeUSmuySXuYBAEVWDWmolWFro/IBMdz69iZ7dB2U//3+TPQTYh16raX8kJ8H7/f3fnukpo2mLAlrGtKkFyScllwVhLcl1qgBrVTO1neH95VFGyQkISzPH6Tvo4BYgVfE4bz+HJxevwuHg6i/qiRhCEpLxqKBhEAreDcwoFdvRNNJ3n8EW7gvBCkVkF/UihNdEXUlxFhaxkbLI12DgWskNJhOMGuCBgkZw0W9zXK42sNm1LIcDpXQgcaD7pU9R5l0v3acNXT6biHbU7ubBNzj8MuVr3IABiOGaztGYAgAbpSSsBC6TCcx7gRAjH1aXWNCmVMxt7Cc51QAqW3ZXyNvLhNaEyhbPUNpe4pO8g7gwxiJA4wVs7quUjPOD7MSa3Rc1H6+l5xcVNSfnuA+9abPYXdcGe7193PWr89DfheCC5muoN1cf92I57xAlLyDa4o8owLVNUUKjRq2Jqi7Ddj3o7f/oA3UIA1WjV4pjsV5ECJBvWiKMtOuVfoWcZpVDbMjq6TJZXER+C7pSUlSFqEIDQ/1xXpLRRMQ1iXnlU+RA9RZIjD3U2ZVJAVht8MTIpRe/tBlQRbjWFcFZQ32vxnBOO60KrR/XSSuLrOlS7c8Vt38N6NRGI62eM/J7rY6DMUxNxAQGnsPhWX1rMFi0iZODCTeSdg692gwf0oGkzj9oFXKDkKJxuhd+1FHVNF72mROibBVCDdxASzVqUtTfV+ufsdgV2h/ezxgn7Z2f9nZ7/ssn+8y8jTVkkwT+WeuQ9B8wukIKHhLfcKuP+wCP5gILcS91Hlv89+AOsP1Hu/CQAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-899c0ab3-bfe0-49d2-b9f7-587148b216af" Scope="Local" Type="Action" RunPrivileged="false"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Submitted

Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
var messageToRetailer = instance.getSimpleVariable("MessageToRetailer");
if (messageToRetailer) {
	PDSLib.PDSSupplierProcessNotes(node, "Message to Retailer: " + messageToRetailer, logger);
}
PDSLib.PDSSupplierProcessNotes(node, "Product getting processed", logger);

/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
allPackaging.toArray().forEach(
	function (packagingObject) {
		if (messageToRetailer) {
			PDSLib.PDSSupplierProcessNotes(packagingObject, "Message to Retailer: " + messageToRetailer, logger);
		}
		PDSLib.PDSSupplierProcessNotes(packagingObject, "Packaging object getting processed", logger);
	}
);*/
  </javaScript>
</config> -->
                <Name>Proposal - Submit - OnTransition</Name>
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAALVVTVPbMBA9x79C4wPjUGq3tw6JwzgQZugQSBNajoxib4xAkVxZClCG/96V5XyRoQTa3uS3q/f2y6uCm5yJK1oUnEF5xSZXqRQTlrdLBHSncGaHxe2D+yknM1AlkyL2P4effAIilRkTeex/vzj++MU/6HjtrimZgLIcGg4dj5AFMKjoyKrdQSdHsT+ECSikg3N9DaqbzL2SVKOcb4mQakAVnYLGGBywCpE1mqyb+OTioYDYv6EzGnIq8nCkFQbrdwb9o37YHSbh4GgUfjNgoDcDocORGU+Z1pC1owVtrRytS7ej9ay2T/QrRjNKFSv0eoqXTF93mcjKrXN13i8mucN1a61lOz+N1C3smzssm+e+qw6648FOrlueJbAafVpU34TMEYIjoRVNNYbhbhwahWXX5+MbSLV1Oaw9aq2EM1rWvkJmUMOLhA45LRd2w7k7Ra/qnso8x3H5syCvnP6VZJ3qpVS3Ey7vXtG+q93eom61o9XKb4zjxiz0lJKqj8NEc/jfM3EqU8rZLzrmUCtewLTgVEPXiIxDtGXMyz/h5YBnVBEmSk3xlyYxsaMT5rAo/kltCuZlbrY8e2VaxyWHoCnjKBgvaOz9EcOA4QdVzGYRuAz7zy85GCnZhAQblE3y6DVwgZyysd0jI1NtUTVQMkXXM6mhDGy8e2SNnmhJ5hT7tYl82Ix4j7ixRfkn7w0yaMhMqglmqbGEpHCOkDnzCq0X7dpaUc4HNL2lufWO7b1kBTlWctq7x5YJyucL69iIamWFMKPcYN+Dx40/e7/q1RPKrPKHWiZK0YegGU6k6tH0OvAak5qOBMXcz+2RqsKNl4vfeK38z/j+vhONxpP3XtVlkWWFb9EhVGu2dqN3vEZLxD3D9Yv+G6F8GrLxBwAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-8ee4bfa0-2d1c-4a24-baa2-d2c83097653b" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}
 
var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-4");
var assigneeID = task.getAssignee().getID();
workflowInstance.setSimpleVariable("SupplierUserID", assigneeID);
debug("Task assignee (SupplierUserID) = " + assigneeID);
  </javaScript>
</config> -->
                <Name>Rework - OnExit</Name>
                <Configuration>H4sIAAAAAAAAALVVXW/aMBR9z6+w8oCCtiabtIdJEBAfq8RUtGrQ9RGZcPHcGjuzHbp26n/fdeyksKpikzqe4nPvPed+2ZSiYlyuaFkKDmbFt6tCyS1nfYOAHZTe7LG8P/y5E2QP2nAl8/h9+i4mIAu14ZLl8dXy/OxjPBxE/XFluARjvlYCBhEhLXBZ05FDu4dm0zz+TPd0UWhe2sY+KiwKXXP7fczlxsSOC9kuqaY7sJiGBw4h4pi8N1nel5DHN0ibCipZurAaE40HHWF7R5V0flTK9rAc//FUkz/XhfnPYYfZXuQInMaclvWZkAYh2CmraWExDR8xqbQGab+sb6CwzmUSPILWSHBqgq9UGwhwW9BEUNPaKyH8V3ZSd04lZaBPKO6812uJXih2WlPUTq8lGfp7rfTtVqi7E9p3we1f1J12djjuftbGvbCAn7RWeo4bjM3934t4oQoq+ANdCwiKS9iVgloYV3IjIPvLnJ+u38sJ76kmG1hXbI6bSnJidQW9KMqycxUMeJdZGm0rWV9djyU7w7rkVy3LtyRpGRrQ/fxWpHdUS6SoQ3q18TF6jEjklJvhzaSxVBYuAXdjUgbt+BtT0vgiiQu11Nyi+58MLnSJpvH9bJr4xi4sdu7sgz+EaNwNziTAbOpqRn8XNwpg0nUnjEfnZ/wG7ILjNOAb1dyNqFGp6gdXXxnQs6nH3h7oIJdvnTe5HFsrSY6ju5hU2Jc3RxTPZn4A1E9nPzt+mPHpzo7f7vA38Bv79Vg5JgYAAA==</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-90642959-a970-4c3c-a427-4025c92d457b" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Submitted

Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
var messageToRetailer = instance.getSimpleVariable("MessageToRetailer");
if (messageToRetailer) {
	PDSLib.PDSSupplierProcessNotes(node, "Message to Retailer: " + messageToRetailer, logger);
}
PDSLib.PDSSupplierProcessNotes(node, "Product getting processed", logger);

/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
allPackaging.toArray().forEach(
	function (packagingObject) {
		if (messageToRetailer) {
			PDSLib.PDSSupplierProcessNotes(packagingObject, "Message to Retailer: " + messageToRetailer, logger);
		}
		PDSLib.PDSSupplierProcessNotes(packagingObject, "Packaging object getting processed", logger);
	}
);*/
  </javaScript>
</config> -->
                <Name>Rework - Submit - OnTransition</Name>
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAALVVTVPbMBA9x79C4wPjUGq3tw6JwzgQZugQSBNajoxib4xAkVxZClCG/96V5XyRoQTa3uS3q/f2y6uCm5yJK1oUnEF5xSZXqRQTlrdLBHSncGaHxe2D+yknM1AlkyL2P4effAIilRkTeex/vzj++MU/6HjtrimZgLIcGg4dj5AFMKjoyKrdQSdHsT+ECSikg3N9DaqbzL2SVKOcb4mQakAVnYLGGBywCpE1mqyb+OTioYDYv6EzGnIq8nCkFQbrdwb9o37YHSbh4GgUfjNgoDcDocORGU+Z1pC1owVtrRytS7ej9ay2T/QrRjNKFSv0eoqXTF93mcjKrXN13i8mucN1a61lOz+N1C3smzssm+e+qw6648FOrlueJbAafVpU34TMEYIjoRVNNYbhbhwahWXX5+MbSLV1Oaw9aq2EM1rWvkJmUMOLhA45LRd2w7k7Ra/qnso8x3H5syCvnP6VZJ3qpVS3Ey7vXtG+q93eom61o9XKb4zjxiz0lJKqj8NEc/jfM3EqU8rZLzrmUCtewLTgVEPXiIxDtGXMyz/h5YBnVBEmSk3xlyYxsaMT5rAo/kltCuZlbrY8e2VaxyWHoCnjKBgvaOz9EcOA4QdVzGYRuAz7zy85GCnZhAQblE3y6DVwgZyysd0jI1NtUTVQMkXXM6mhDGy8e2SNnmhJ5hT7tYl82Ix4j7ixRfkn7w0yaMhMqglmqbGEpHCOkDnzCq0X7dpaUc4HNL2lufWO7b1kBTlWctq7x5YJyucL69iIamWFMKPcYN+Dx40/e7/q1RPKrPKHWiZK0YegGU6k6tH0OvAak5qOBMXcz+2RqsKNl4vfeK38z/j+vhONxpP3XtVlkWWFb9EhVGu2dqN3vEZLxD3D9Yv+G6F8GrLxBwAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-99f4e274-8802-45f3-b9b7-2b47c5073685" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Submitted

Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
var messageToRetailer = instance.getSimpleVariable("MessageToRetailer");
if (messageToRetailer) {
	PDSLib.PDSSupplierProcessNotes(node, "Message to Retailer: " + messageToRetailer, logger);
}
PDSLib.PDSSupplierProcessNotes(node, "Product getting processed", logger);

/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
allPackaging.toArray().forEach(
	function (packagingObject) {
		if (messageToRetailer) {
			PDSLib.PDSSupplierProcessNotes(packagingObject, "Message to Retailer: " + messageToRetailer, logger);
		}
		PDSLib.PDSSupplierProcessNotes(packagingObject, "Packaging object getting processed", logger);
	}
);*/
  </javaScript>
</config> -->
                <Name>Waiting For Assets - Submit - OnTransition</Name>
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAALVVTVPbMBA9x79C4wPjUGq3tw6JwzgQZugQSBNajoxib4xAkVxZClCG/96V5XyRoQTa3uS3q/f2y6uCm5yJK1oUnEF5xSZXqRQTlrdLBHSncGaHxe2D+yknM1AlkyL2P4effAIilRkTeex/vzj++MU/6HjtrimZgLIcGg4dj5AFMKjoyKrdQSdHsT+ECSikg3N9DaqbzL2SVKOcb4mQakAVnYLGGBywCpE1mqyb+OTioYDYv6EzGnIq8nCkFQbrdwb9o37YHSbh4GgUfjNgoDcDocORGU+Z1pC1owVtrRytS7ej9ay2T/QrRjNKFSv0eoqXTF93mcjKrXN13i8mucN1a61lOz+N1C3smzssm+e+qw6648FOrlueJbAafVpU34TMEYIjoRVNNYbhbhwahWXX5+MbSLV1Oaw9aq2EM1rWvkJmUMOLhA45LRd2w7k7Ra/qnso8x3H5syCvnP6VZJ3qpVS3Ey7vXtG+q93eom61o9XKb4zjxiz0lJKqj8NEc/jfM3EqU8rZLzrmUCtewLTgVEPXiIxDtGXMyz/h5YBnVBEmSk3xlyYxsaMT5rAo/kltCuZlbrY8e2VaxyWHoCnjKBgvaOz9EcOA4QdVzGYRuAz7zy85GCnZhAQblE3y6DVwgZyysd0jI1NtUTVQMkXXM6mhDGy8e2SNnmhJ5hT7tYl82Ix4j7ixRfkn7w0yaMhMqglmqbGEpHCOkDnzCq0X7dpaUc4HNL2lufWO7b1kBTlWctq7x5YJyucL69iIamWFMKPcYN+Dx40/e7/q1RPKrPKHWiZK0YegGU6k6tH0OvAak5qOBMXcz+2RqsKNl4vfeK38z/j+vhONxpP3XtVlkWWFb9EhVGu2dqN3vEZLxD3D9Yv+G6F8GrLxBwAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-9df6765e-f1dd-4a9a-8599-b2760193b1ec" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
// System Messages are stored on entities, for localization purpose.
var msg1 = manager.getEntityHome().getEntityByID("SysMsg_RejectedByBuyer").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Rejected by Buyer
var msg2 = manager.getEntityHome().getEntityByID("SysMsg_ReworkRequestedByBuyer").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Rework requested by Buyer
var msg3 = manager.getEntityHome().getEntityByID("SysMsg_ApprovedByBuyer").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Approved by Buyer
var msg4 = manager.getEntityHome().getEntityByID("SysMsg_AutomaticallyApproved").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Automatically Approved
var msg5 = manager.getEntityHome().getEntityByID("SysMsg_WaitingForAssets").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Waiting for Assets

var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-8");
var isNewOrUpdate = workflowInstance.getSimpleVariable("IsNewOrUpdate");

if (isNewOrUpdate && isNewOrUpdate.equals("New")) {
	var approvalBuyerStatus = node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").getID();
}

if (isNewOrUpdate && isNewOrUpdate.equals("Update")) {
	var approvalBuyerStatus = node.getValue("PMDM.AT.UpdateApprovalBuyerStatus").getID();
}

if (approvalBuyerStatus) {

	// 1. or - if just one is rework -_-_-> trigger 'Rework'
	if (approvalBuyerStatus.equals("RW")) {
		logger.warning("doing Rework. Buyer Status: " + approvalBuyerStatus);
		task.triggerLaterByID("Rework", msg2); // "Rework requested by Buyer"
	}
	// 2. or if at least one is approved -_-_-> trigger 'Approved'
	else if (approvalBuyerStatus.equals("AP")) {
		logger.warning("doing Approved. Buyer Status: " + approvalBuyerStatus);
		task.triggerLaterByID("Approved", msg3); // "Approved by Buyer"
	}
	else if (approvalBuyerStatus.equals("WA")) {
		logger.warning("doing Waiting for Assets. Buyer Status: " + approvalBuyerStatus);
		task.triggerLaterByID("Waiting", msg5); // "Waiting for Assets"
	}
}
  </javaScript>
</config> -->
                <Name>Automatic Forwarding - OnEntry</Name>
                <Configuration>H4sIAAAAAAAAALVX3XLaOhC+xk+h4SJN5gT7pG1mzhwgGUjaaTqhZRJaLjMKCB+nsuRKclK3k3fxs/jJzuoPTCETSukNY2t3v/2+9WqFMprHCbvBWUYTIm+S2c2Es1kSdyQsqJPMmu1at3P6LaXongiZcNZtHoV/NxFhEz5NWNxtfhq9bf3TPD0JOv1cJoxIeZVTchIgNF8YGjhUt9uli/Nu8z2+x9cTkWTK23sTBYnGifqvn7CpbGosQBtigVOigIZdqC8hjWS90ajISLd5B7AhxSwOr5UAos2TParaS0r2vuZctUGOfVhosu9GmH083YtVO9AAOscAZ+YdIb+CoFJK4IkCGjbiLBeCMPXx9o5MlHY5cx4uV48mWDpfxqfELc8FnVEs5/acUvsUPZt3gBmOiXgmY2q9dpX0ksfP56TGaVcpXX3HXHyZUf7wTO4H5/Yr2XXuqP65O9E87okGfCMEFwPoYCjun27ESz7BNPmObylxGUckzShWpJ+zKSXRhpwX2+9pwlFUldeFVCStSi+vKrEgVSkVF2RalZxVJXyPRME4OazKGRdVSR1FvZurMstFxiUJg3ssUCrjI9RFrg/DmKg3Orh4x1Oyf7B47xcX5/tWOhAYyPjmiugdRab9op8Xvp9MxGdMc+Kch4PzQdgbhZa141zzvU6gVsRGHLRRFCGPW5W3RVUabM/05bZMddtdka85kX+EsIavSuETrGH+ajvmvSwT/H73lD3uGqavt2SaK55Cg0Gj0cLD745vHb0qPb7nfLwd5zGGXcLit1z0pCRK7oyuA0aw+ZCFDgxVP/0umFSYTQjQ1keOBhn/ZNr3vgdtE6qw/ALuPyPo0BGY6uIUjB4/plx0Ij+Qh4/iUzYF2xMwXoZI9ChzYBf1wDlkkMzQ/jLmHk6ztvlZThbCpsBUOjgwOJAD9CNoaGrYfEtMTRNq7rmslWXddxgKDvML095qZO2rQD2A6eP2XJc0/wZdi/MLZNek0OmDBnTWUYigp1oI/O5yqRBnBDQgYUYQarVa+rBBcFroIx69sKPpRdB4AndZ8dW4rrZh/yeED1gwaGbnM+W6sS1uiAwUslj/Indo/rWuSCCv0dBNHDpyl1AUUWtbC2mfD82wt3upbkXzEYtuC1QbiUHj0ZTnpSkPiMUKUYIXBcJuYqyWyM8SKBKhkqCNKtUbblopD7/TWi3PV1OtV/Vqefu6Km0uctzbVOTqvNupXAdfU3tcV7uafSH3cfWPV23B3F860fLtCO5P0fIFyt3F/gdJ9nYqqw0AAA==</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-abf5c7de-5acb-4009-b73f-44d94df31062" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
/*	Set NewDataSource	
	-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-
	Workflow:       PMDM.WF.ExternalSourceRecordhandling ("External Source Record Handling")
	Business rule:  Proposal.OnEntry

	Set NewDataSource worklfow variable to true if PMDM.AT.ProposalApprovalBuyerStatus on Data Source is null
	-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-*/

var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

var workflowInstance = node.getWorkflowInstance(workflow);
var proposalApproval = node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").getValue();
if (!proposalApproval) {
	workflowInstance.setSimpleVariable("IsNewOrUpdate", "New");
} else {
	workflowInstance.setSimpleVariable("IsNewOrUpdate", "Update");
}
  </javaScript>
</config>
Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="processedByAttribute" type="Attribute" contract="AttributeBindContract">
      PMDM.AT.ProcessedBy
    </binding>
  </bindings>
  <messages/>
  <javaScript>
function getSingleValueLovID(product, attributeID) {
	var value = product.getValue(attributeID);
	if (value) {
		return value.getID();
	}
	return null;
}

var processedByAttributeID = processedByAttribute.getID();
var processedByValue = getSingleValueLovID(node, processedByAttributeID);
if(!processedByValue) {
	node.getValue(processedByAttributeID).setLOVValueByID("STEP");
}
  </javaScript>
</config>
Action #3 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
/*	Forward automatically if needed.
	-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-
	Workflow:       PMDM.WF.ExternalSourceRecordhandling ("External Source Record Handling")
	Business rule:  Proposal.OnEntry

	Forward product if automatic approval of new source records or changed source records is enable for the supplier
	-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-*/
	
var debugMode = true;

//For debugging.
function debug(msg) {
	if (debugMode) {
		logger.warning(msg);
	}
}

function getSingleValueLovID(product, attributeID) {
	var value = product.getValue(attributeID);
	if (value) {
		return value.getID();
	}
	return null;
}

// System Messages are stored on entities, for localization purpose.
var msg1 = manager.getEntityHome().getEntityByID("SysMsg_SSourceRecordAutomaticallyApprove").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // %s SourceRecord Automatically Approved
var msg2 = manager.getEntityHome().getEntityByID("SysMsg_SSourceRecordAutomaticallyProceed").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // %s SourceRecord Automatically proceeded

var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-1");
var newSourceRecordHandling = getSingleValueLovID(node, "PMDM.AT.HandlingNewEXT");
var updatedSourceRecordHandling = getSingleValueLovID(node, "PMDM.AT.HandlingUpdatedEXT");
var processedBy = getSingleValueLovID(node, "PMDM.AT.ProcessedBy");
var workflowInstance = node.getWorkflowInstance(workflow);
var isNewOrUpdate = workflowInstance.getSimpleVariable("IsNewOrUpdate");

// -_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- PHRE modification start -_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-
if (!newSourceRecordHandling) {
    //  PMDM.AT.HandlingNewEXT should default to "Manual"
    node.getValue("PMDM.AT.HandlingNewEXT").setLOVValueByID("Manual");
    newSourceRecordHandling = "Manual";
}
if (!updatedSourceRecordHandling) {
    node.getValue("PMDM.AT.HandlingUpdatedEXT").setLOVValueByID("Manual");
    updatedSourceRecordHandling = "Manual";
}
// -_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- PHRE modification end -_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-

if ((isNewOrUpdate.equals("New") && newSourceRecordHandling && newSourceRecordHandling.equals("Auto1")) || (isNewOrUpdate.equals("Update") && updatedSourceRecordHandling && updatedSourceRecordHandling.equals("Auto1"))) {
	var message = (msg1+"").replace("%s", isNewOrUpdate); // "%s SourceRecord Automatically Approved"
	task.triggerLaterByID("Proposal.AutoApproved", message);
} else if (processedBy && (processedBy.equals("PDS") || processedBy.equals("GDSN"))) {
	var message = (msg2+"").replace("%s", isNewOrUpdate); // "%s SourceRecord Automatically proceeded"
	task.triggerLaterByID("Submit", message);
}
  </javaScript>
</config>
Action #4 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Submitted

Action #5 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
PDSLib.PDSSupplierProcessNotes(node, "Workflow started", logger);

/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
allPackaging.toArray().forEach(
	function (packagingObject) {
		PDSLib.PDSSupplierProcessNotes(packagingObject, "Workflow started", logger);
	}
);*/
  </javaScript>
</config> -->
                <Name>Proposal - OnEntry</Name>
                <Description>Logging and initial creation of data</Description>
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAAO1a3XLaRhS+lp5iy0w8OHVEnatOsJ2BgBt3TEwNcXrnWaRFViK0yu4KhyZ+F56FJ+vZPyHxZ1KTTtLaFzbsnv9z9ttzdpzGWRgl1zhN44jw62h47dNkGIVHHBbESaq39drx0ctPoxiNCeMRTY4rh94vFUQSnwZREh5X3vZPn/1aeXniHjUzHiWE88ssJicuQvlCV4lDxX29dNY6rvyOx7jnsygVdr/hC1D0LhI3zSgJeEXKAmldzPCICDBDLxSXkJSkqVF/kpLjynsQ68U4Cb2eYGBo5WQvFvWSJ3sfMyrq4I7+MPdJf1eO6Y8v90JRd6UAqaODU/UdIbuCIFKCYV+AGZrjVcYYScTF4D3xhSR5ZSiMrkYcYW5oExoQs5w79CrGPN/P4lh/qt2r95yGIWH3KIwV0a5UGlffUfZhGNPbe3TfGrKv0S5114qRP6rlfGtqoc0YZR0oJhySb10T59THcfQXHsTEaOyTURpjQZpZEsSktqXN85Ow3uDaU6dHBHpDbltY4B7NmE8c13m2mx/XsVl8oS1E3U6r47079dqfwMoEx1rjJfEpC24weAdWoaqOiKVBmghpKvTakGmifdex5xwxAAJQ1GU0pRzH3kXShrqZuO6yj0jWTTykt2iMWSRDjQRFgmUERUNtZaPvWUmNNGV0jONmNiGsJ7DIOKIJkuKscRFHssx2FbqnNdcFy1BABlnYgQONjpV1ddet1U6p2QDICz13mCUK4fRadcTDffRZlQS4Us0l2EX5o0+sd4tZAiIUS11t3rl3WrE9V2cJFzjxpX6JK15I8pNpt6qWFmRI1nQhagXWKxxnxKR3iyCbFM85QYP06adFFdI3Z9FkjxPRi+DkkCuTY6P5jEMtXLC3aQBnSi8dIP0XNozSunuHSMzJriQX16TwpfNbWFA30lGtfN89XoH/myuwISDAgwwAf7NWKH4fskuC5iRn2WSDT0ceF9GAeoCkxAvoCEeJJwvZy/nP4JumlmYWDqnVlN+ej3dp2eAch0OJDkko0QFA65yOz1pVSFWQ+eIA4TzQLYVaEjHHkg5g0hDN8a5IXHcdiX2KVnE6jIiMJZpb8oAaSXXn2h1Zc3WL6KuK5ayltS5tzMUtsF4ZU1f5KE/dwRo9CrkVcJckKUfKt8Mafom55xdXiqY5AW061b1+uzsH1eVMPqLq94mqHZzg+2F1pKl+YCh/nGb+3WkGemPoagOEMwG3m4hAeTyRjXBCSEAC778321iPzeUhfc2dR9j24FRG4BZxrY4pdTDEMOSDaSEJFndgniGJmouGQCRuCOKZet1hOxxxnAfOOM7SgOM4K0cbR8013/EFXavNpr0JF2Q0m9qDOZtiRmZTLqBXC2ZTmsymgCSRiAg/mE0hLbNpbA6X9Go2TTMGxUE8FVVw/BAsNggqtbcl8+Q1HcEcNf9evEsnvMPD616xcBvFc6THLTvErBvotB/GiwKtnZj0IIdqNfQEfCwqm01L6uCrVhhYj57v2iPV15Jghx6hoi5UUqZbIwlDD56xBeYfgHxpMAXWPmwVQwCTNHl2mPdIkhuQoGilRZ2NbV05IpYFxt32n/2S8EwNusGOFOixOVhUUmgSv0JocYopSntAIqLixL8mI9s+Fewr5EMrsBJ1X1+20Qgu2yGUksIwEM/EKlr9QrImxfYRCNSg1blE/IZmcQBAO8RZLOSzWN6xZdh0HkrGpkedlfWxpoUvCjbPUOsLdJlF4qdyeUPhWbe3MXmp4rY3e3PprzZ964QTaC9XpVs5Xy3VoUc+gg5eXXzTQnt4lNbVr7Uhvp+kLF0inEWXffTlC9pkSqnai6o2RW47sg1W5df4SCM45EL2BYc/m3cOk2ZGoC31bVk84fb9ruSPhnlLsuX1ZQ6NI1Hbg4ZBdijnIIwVyinv7KSMMuOBNXz+KClzXsTAQoyK6+WgdFs9G3rI01qy31q9N/eE7vnDQ7fVPblN4HrZYBSJFZH6lo8Bl2RIYK7zyQW0xqzZKD8JbP0SkIsJmo31Y41CqOZlw4MEen9kJCPtMXSCnvYczsPjq8cP8urxjR4gHp8A5mel1TuPBvKk9My8apq+N1QQXuoKbWunW6k52Or4q2bsqYQ+gKQu9j/gMO9gG4WVU0ZHdpq3R+TUDJoekaMf+Fn9vFRLL1QzcgdqivI9wH7G8ATmGRjw2ti/qbpOPrdWU0unK1dPmfe4vMCztfcwpu7XYUj/B+AyX9H/u2H+DeRvk5CjnyYiAAA=</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-bdab400d-b94c-4476-ac1e-4a124c9230b9" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.CreateInternalFromExternal

Action #2 (RemoveObjectFromWorkflowAction):
Workflow=
Message=Source Record Creation Done
 -->
                <Name>Source Record Creation Done - OnEntry</Name>
                <Description>End workflow</Description>
                <Configuration>H4sIAAAAAAAAAJ2SMW+DMBCF9/wKy3uh3ToAEZRGyoCCSKqOyDUHdWpsyzY0/fd14iQNijKkm/XO9917p1N86JioiVKcgalZW1MpWtZFxgk2Ub7stTia73qORtCGSRHjp+ARIxBUNkx0MX7bLB6e8TyZRdlgmABjqoFDMkPoLJQHHLqse2mZx7iCFrTDwcp+gs7S06+UWjcO70EOVRJNerDOgxcuJTTBNFmK0eZHQYy3ZCQBJ6IL1lY7szgpi7wIsioNXjQQC0vh2gXhCy37151/R+EZfJwdTodH4TTXPVF7OcLqYwvU7ke+S/3Vcvl9Z9RT2+2YVxmuGIUzRzq4jVjLQVNAFVCpG3RYl/OIcingHxv6U/xxHO/sFyN7FW2HAgAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-bffd49c2-e0d0-4471-ab49-71eeb80262bc" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Returned

Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
var messageToSupplier = instance.getSimpleVariable("MessageToSupplier");
if (messageToSupplier) {
	PDSLib.PDSSupplierProcessNotes(node, "Rework: " + messageToSupplier, logger);
	
	/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
	allPackaging.toArray().forEach(
		function (packagingObject) {
			PDSLib.PDSSupplierProcessNotes(packagingObject, "Rework: " + messageToSupplier, logger);
		}
	);*/
}
  </javaScript>
</config> -->
                <Name>Automatic Forwarding - Rework - OnTransition</Name>
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAALVVTVPbMBA9279C4wPjUGq3tw75YBwIM3QIpAktx4xw1kagSK4sBSjDf+/KskNChpIy7c162t339kPrgpuciSktCs6gnLJsmkqRsbxTIqB7hbt2WLdzcD/nZAGqZFJ0g8/Rp4CASOWMibwbfL84/vglOOj5nb4pmYCyHBsOPZ+QJTCqwpHVewedHHWDMWSgMByc62tQ/aSxSlKNdIENhKFGVNE5aNTggFWIrIWZ9ZOAXDwU0A1u6IJGnIo8mmiFYoPeaHg0jPrjJBodTaJvBgwMFiB0NAZtlIBZJ15GrYnjdeZOvJ7U9nl+RTGTVLFCr2d4yfR1n4lZuXWqzvrVHHe4bq91bOenkbqNbXMfz71z56qB7vNgJ9dt3wawHENaVGdCGoTgRGhFU40ynMehUVh1fX51A6m2Joe1Rc2VcEbL2lbIGdTwMqFDTsvlveHcfcXb8l5KdZtxefcG811t9q/YT2We46z+mZRXRn9DaQnj1cpvjOPGLAyUkmqIw0Rz+N8zcSpTytkvesWhZryAecGphr4RMw7xlpqfX8LrghdUESZKTfFFky6xoxPlsOz3SX0VNp1ttX3rMq91yYmpVptC3yaM9Z8wFAw/qGI2i9BlOHzp5GAMyTISboRskUffw/1xyq7sGmngkZIpmp5JDWVo9e4RF2cMVuR+fSIfNkXuETcryOj5XrxrM6Gcj2h6S3F75JgEak9WkGMl54N7LKigvFknx0ZUCyWCBeUGuxI+bry7/aqST5ZolSDSMlGKPoStKJNqQNPr0Pe8rA5IwqIxdO+8qoD3Vg1eOL2vHN6T77Xau7H/9I7V/Iy4X1L9d/sNxT+hSP0GAAA=</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-ca52f380-004b-4e40-8caa-9e28596099c9" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
// System Messages are stored on entities, for localization purpose.
var msg1 = manager.getEntityHome().getEntityByID("SysMsg_RejectedByBuyer").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Rejected by Buyer
var msg2 = manager.getEntityHome().getEntityByID("SysMsg_ReworkRequestedByBuyer").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Rework requested by Buyer
var msg3 = manager.getEntityHome().getEntityByID("SysMsg_ApprovedByBuyer").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Approved by Buyer
var msg4 = manager.getEntityHome().getEntityByID("SysMsg_AutomaticallyApproved").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Automatically Approved
var msg5 = manager.getEntityHome().getEntityByID("SysMsg_WaitingForAssets").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Waiting for Assets

var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-3");
var isNewOrUpdate = workflowInstance.getSimpleVariable("IsNewOrUpdate");

if (isNewOrUpdate && isNewOrUpdate.equals("New")) {
	var approvalBuyerStatus = node.getValue("PMDM.AT.ProposalApprovalBuyerStatus").getID();
}

if (isNewOrUpdate && isNewOrUpdate.equals("Update")) {
	var approvalBuyerStatus = node.getValue("PMDM.AT.UpdateApprovalBuyerStatus").getID();
}

if (approvalBuyerStatus) {

	// 1. and - if both are rejected  -_-_-> trigger 'Rejected'
	if (approvalBuyerStatus.equals("RJ")) {
		logger.warning("doing Reject. Buyer Status: " + approvalBuyerStatus);
		task.triggerLaterByID("Rejected", msg1); // "Rejected by Buyer"
		
	}
	// 2. or - if just one is rework -_-_-> trigger 'Rework'
	else if (approvalBuyerStatus.equals("RW")) {
		logger.warning("doing Rework. Buyer Status: " + approvalBuyerStatus);
		task.triggerLaterByID("Rework", msg2); // "Rework requested by Buyer"
	}
	// 3. or if at least one is approved -_-_-> trigger 'Approved'
	else if (approvalBuyerStatus.equals("AP")) {
		logger.warning("doing Approved. Buyer Status: " + approvalBuyerStatus);
		task.triggerLaterByID("Proceed", msg3); // "Approved by Buyer"
	}
	// 4. or if Supplier is set to Automatic Approval -_-_-> trigger 'Approved'
	else if (approvalBuyerStatus.equals("AA")) {
		logger.warning("doing Approved. Buyer Status: " + approvalBuyerStatus);
		task.triggerLaterByID("Proceed", msg4); // "Automatically Approved"
	}
	// 5. or if digital assets haven't been provided, yet -_-_-> trigger 'Waiting for Assets'
	else if (approvalBuyerStatus.equals("WA")) {
		logger.warning("doing Waiting for Assets. Buyer Status: " + approvalBuyerStatus);
		task.triggerLaterByID("Waiting", msg5); // "Waiting for Assets"
	}
}
  </javaScript>
</config> -->
                <Name>Automatic Forwarding - OnEntry</Name>
                <Description>Check the Proposal Statuses and forward to next state</Description>
                <Configuration>H4sIAAAAAAAAAM1YbW/iOBD+DL9ixIe+6Eq4vkmnA1pBu6vtqtyiwh4fK0PcNF0TZ22HHnfqf8lvyS+7cWxDsoDacqx0X6rEnnnmmSfjGdyYJUEY3ZM4ZiGV9+HD/YRHD2HQkrigLmKzbdbarcu/pgxmVMiQR+3asfdrDWg04X4YBe3a1+HH+m+1y4tqq5vIMKJS3iWMXlQBFgv9HA6K+2bp5rpd+0xmZDARYazcfmeiMNAoVI/dMPJlTWMhWp8IMqUKaZiF4hJoJGMNw3lM27UnhPUYiQJvoAQSrV3sMdUsZbL3PeGqiemYh2VO5j1PzDxe7gWqWdUAOkaPxPk7gFsBVEoJMlFIw3hcJULQSH0ZP9GJ0iZX1sLG6rCQSGsbcZ/a5UVCV4zIxX7CmHlqvBq3RyISUPFKxKmx2lXQWx68HpPlRrsKafUdcfHtgfHnV2I/W7P3RNexG8XP3Wos/DYU4AchuOhhBaO4P7sQb/mEsPBvMmbURhzSacyIot0k8hltvJHz8vhtJtxoZOlgLhWdZqlLL0uJoFkqFRfUz1IeZSl+j1BhOznK0gcuspRZivo0Z2mciJhL6lVnRMBUBsfQBluHXkDVB+08/8Sn9OBw+d6d31wfmNSRQE8G93dUnyjqd+fdZO7qKff4k7CEWuN+77rndYaeYW05F2wHIWpFjcdhExoNcLhZOp5naY7tmJ5sy1SX3R39nlD5Uwhr+CwVLsAa5qfbMe/EseCz3VN2uGuYnm3JNFF8igWGhcbmDn53fIvoWerwHefz7TiPCJ6SKPjIRUdKquTO6FpgwMMHBrqaU3Xd7yaSikQTirT1yNEgox+2DpztYTN3VUR+Q/MfEbTrELeKySlsPfVTS9B4h/IP+vxFfI193NsA49IQoW5lFuym6LiArIYPcFDG3CPTuJn/KQfz8FAQJi0cbliQQ/inWtHUSP4tCcuLUHNPZEGWdd+hLzj2L8I6q56Fr4J6INOX7bmWcv4PdA3OO8iuCaHDVytYWcceEJzCdUDDMVePgL0fhO2YAPV6XU8bwHGhZzzsu2a6X61sgC4nffe5mHDF/FTwnomIsJ6tjc91bRtkD3IoMFi/g52bv6zTCTOsVHQde5beLeoiCpXryJq3o3w2mQNV3ofxHAr9EFGrlZdcnhMP8Mjl6jwlUgGPKH5iFEgX/Dp19DpqQ5mk8DaBRm8XSIPvWCANWZDnpCxPnuViDK3IZDQ6zTXCZIkCRslSJWK76qpOrt++S6lO/61KOfidaoVdYkJLtXRaFMvF3CDSmRNpkOQ3M91CARs5KL4cRuAO9a4U6/zPFDsrKVacwVAe8U62cyebHwahQmFIPv3gkcxotK9gTGkE2jH0qX8EcxR0RbrV4fkuEUdvFnE10E7ltPAFOc+Lcq5GX0r5snpdKCzkt+5Wo3ynx1t/o3ztt/9B+BehW7G8YRAAAA==</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-cae536f8-4628-4b82-9831-984c96d3afc6" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("Waiting for Assets");
var userID = workflowInstance.getSimpleVariable("SupplierUserID");

if(userID) {
	var userObj = manager.getUserHome().getUserByID(userID);
	if (userObj) {
		task.reassign(userObj);
	}
}
  </javaScript>
</config>
Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
instance.setSimpleVariable("MessageToRetailer", "");
  </javaScript>
</config> -->
                <Configuration>H4sIAAAAAAAAAO1WS2/aQBA+41+x8gERqbXbWyUwiEejUgU1CqQc0WLW7ibrXXd3DU2q/PfOPmxIK0RTpe0lXPDO4/tmZmfGLlmVU77CZckoUSuarVLBM5r3FAh0v3RqJ0t6g28FQ1siFRU8Cd9Gb0JEeCo2lOdJeL04f/0uHPSD3qhSlBOlripG+gFCjeDSwqFDvRNNJ0n4EW/xPJW01LV+mGogWlL9ZUT5RoUGC9AuscQF0RCGExyKkEFy1mhxV5IkvAHYiGGeR3MtIdCw32a6+yiT9tdK6C6k4x72ObmzTcw9Dtq57gYGwHDMcGnPCNUSBJXSEqcawnAe40pKwvWn9Q1JtTEZewvPNWQUK2/LxYZ4cZPQmGHV6CvG3FN8kneGOc6JPMFYOKvnIr0Q+WlOZo2ei9LXdynkbcbE7gT3zps9hd1wx4fX3YsbvyMN+F5KIWfQwVDcv92IFyLFjN7jNSOecUGKkmFNRhXfMBL/Zsz78Tse8BZLtCHrKp9Bp6IEaVmRbhDE8bnwCpjlPAqyitvRdbJOofIz9N3S0gx1GoRaaH6uK6IdlhwgrEvXKh+ChyAwxPXdTbnSmKeG3wxMlJPm9mtVp7YFDOOqsboF858RjOsCVKO76aTj6rrEVAM/yiChoVJEKyf3QJUicjo5AjWnUHfyGUtqLsMDziu7WuW19WzAApp1HJgpQqvGhjUB4H4qDaZx+yAK0jmrTzZY79oNWqag3tMitUyukSTQzzTnjQosoZC/dMGBwC7TXvx4Vb9s7/+zvV+22j/eavRpS6U2j9SRsa+DFldEY8rq990r5P7rPfAHA7mXuM8r/6X2A+BuVMjJCQAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-d72187c7-703d-4d92-be1a-f27a7a2a4378" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debugMode = true;

//For debugging.
function debug(msg) {
    if (debugMode) {
        logger.warning(msg);
    }
}

/* Saves the current assignee to workflow variable BuyerUserID, so that the person who was in charge can continue with the maintenance of this record */
var workflowInstance = node.getWorkflowInstance(workflow);
var task = workflowInstance.getTaskByID("State-7");
var assigneeID = task.getAssignee().getID();
workflowInstance.setSimpleVariable("ContentManagerUserID", assigneeID);
debug("Task assignee (ContentManagerUserID) = " + assigneeID);
debug("Stibo Test Asset Approval on exit : asset approval state");
  </javaScript>
</config> -->
                <Name>Asset Approval - OnExit</Name>
                <Configuration>H4sIAAAAAAAAALVVS08bMRC+768Y7QEFCtn21KrJBhFSpFRERU0oR+RsJo7Bsbe2NyFU/PeO194QShGt1OYQrefxffO0S1lxoa5ZWUqB9lrMrwut5oJ3LQlcrwzqIMu7x3dLCSs0VmiVp+/ab1NAVeiZUDxPLydnRx/S417S7VdWKLT2ayWxlwBsBRc1HOzqg2g4yNPPbMXGhRGla/QnhSOiK+EWfaFmNvVYhHbBDFuiozCCYFcEHilYw2RTYp7eEGxbMsXbY2co0LS3J13nSSZ73yvtOpRO+HjMKZzrxMLn8R53ncQDeI4RK+szQCMBqpQzrHAURvA4rYxB5b5Mb7Bw3uQ0WkSuEymYjbZKzzCKtwmdSma3+krK8JW9ynuuOUfzCqGsjf4VZUz1SpvbudTrV7jX0exv2D13tlv5brb1e2EWPhmjzYiGiXH83zNxrgsmxT2bSoyME1yWkjnsV2omMfvDmB834eWAV8zADKcVH9HQQA7OVNhJkiw701FBa8XbybxS9RYFWWtp+T78qGnFHFpbhEbof2Eq2mtmFEHULp1a+ZA8EMMBjNkKLbgFQhFaDtQywRUiOA1NY4FCFL4WtO8bNJcWzXBwCFaTJ3O1e0nFptDWC/JiFuhqKBbMcMJlqp4voSqENV0AtfmSCeVQMVUg6DmJhAWDhTYzOMgSX5GGe6isq81y8EvV5rgdy0bVamwpOe/qmL0l818RvOuEVP3NcNAKDR876ujR+3CI3k0BhgPfC7L3fidR2Nr3J/In42f4Ft1Y0JTgt1iuyOJXh0o7YormKFYvaA532AgxNDaofKSPzWj9DmOfAowz/eZloLETUw0TtA4oC6T/sjR6xSRQv/BOOPjonUnBGoX1ZWmK8mzIdwT1td3Nnj4K9GxkT9+N+AT9BGKue++iBgAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="acn-fe538420-f69a-40a3-8673-c23c73395e91" Scope="Local" Type="Action" RunPrivileged="true"><!-- Definition:
Action #1 (ReferenceOtherBABusinessAction):
ReferencedBA=PMDM.BRA.PDS.QueueEvent.Returned

Action #2 (JavaScriptBusinessActionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var instance = node.getWorkflowInstance(workflow);
var messageToSupplier = instance.getSimpleVariable("MessageToSupplier");
if (messageToSupplier) {
	PDSLib.PDSSupplierProcessNotes(node, "Waiting for Assets: " + messageToSupplier, logger);
	
	/*var allPackaging = getAllPackagingFromExternalBusinessFunction.evaluate({"node" : node});
	allPackaging.toArray().forEach(
		function (packagingObject) {
			PDSLib.PDSSupplierProcessNotes(packagingObject, "Waiting for Assets: " + messageToSupplier, logger);
		}
	);*/
}
  </javaScript>
</config> -->
                <Dependency LibraryID="PMDM.BRL.PDS.Library" LibraryAlias="PDSLib"></Dependency>
                <Configuration>H4sIAAAAAAAAALVVy1LbMBRd21+h8YJxKLXbXYfEYRwIM3QIpAltlhnhXBuBIrl6BCjDv1ey7DzIUNLXTj6695z70nVJdUHYFJclJSCnJJ9mnOWk6EgDqG7prh2WdI4e5hQtQEjCWRJ8jD4ECFjGZ4QVSfD16vT9p+Co63d6WhIGUo40ha6P0BIYVnRo/d5BZydJMIIchKGDS3UDopc2VmmmjFxgiQzVEAs8B2VicMA6hDZoZr00QFePJSTBLV7giGJWRGMlTLBBdzg4GUS9URoNT8bRFw0a+gtgKhqB0oLBrBMvWWvheFO5E28mtXuen00w40yQUm1mOCHqpkfYTO6cqrN+Ncc9qtobHdv7rrlqm7a5w6p37rtqoDse7RWq7VsCqzHAZfWNUIMgMxFK4EyZMJzHsRam6ury+hYyZU2Oa4taK6UEy9qW8RnU8DKhY4rl8l5T6k7xrroTLu5yyu/fUL6vzf6V+jkvCjOrvxalldHvSFrBeL3yW+O4NQt9IbgYmGHCBfzvmTjnGabkB76mUCtewbykWEFPsxmFeMeYVy/h9YAXWCDCpMLmRaME2dGJClj2+6y+CpvOttq+dZnXcfGxrlabML4NjfUfExMwfMOC2CxCl+HgpZODDSXJUbhF2UJPvmf2xzm5tmukgYeCZ8b0giuQoY33ADmeCSbK5IRyLlAqJSh5WN+gd9sBHyA3N0bd871432aFKR3i7A4XliZBJo90DTkVfN5/MMVlmDar5VSzarlEsMBUmw6FT1tv8LCq6rMVWheIFE+FwI9hKzIR93F2E/qel9eEKCwbQ/fmq2p4b9XjhdPfl8Z79r1Wez/2n/9gZa8Q96uq/3o/ASSC058VBwAA</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="con-4272bf7e-38bd-43a9-bfd0-5912a8d26a57" Scope="Local" Type="Condition" RunPrivileged="false"><!-- Definition:
Condition #1 (JavaScriptBusinessConditionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
logger.warning("Asset approval test on condition start : condition");
var debug = true;
var errors = new java.util.ArrayList();
var AcceptReworkInconsistent = manager.getEntityHome().getEntityByID("SysMsg_con-cc39_AcceptReworkInconsistent").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'You must populate the "Message to Supplier" field in the previous screen when either the "Rework" or "Reject" options are selected.'
var AcceptReworkInconsistent2 = manager.getEntityHome().getEntityByID("SysMsg_con-cc3_AcceptReworkInconsistent2").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'You must select either the "Rework" or "Reject" options in the previous screen whenever the "Message to Supplier" field has been populated.'
var AcceptReworkInconsistent3 = manager.getEntityHome().getEntityByID("SysMsg_con-cc3_AcceptReworkInconsistent3").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'You need to set a Proposal Status.'
var AcceptReworkInconsistent4 = manager.getEntityHome().getEntityByID("SysMsg_con-cc3_AcceptReworkInconsistent4").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'Products onboarded via GDSN cannot be returned for"Rework".'
var AcceptReworkInconsistent5 = manager.getEntityHome().getEntityByID("SysMsg_con-cc3_AcceptReworkInconsistent5").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'Product cannot be approved because of missing mandatory data:&lt;br&gt;%s'

function log(message) {
	if(debug) {
		logger.info("Proposal Approval Buyer: " + message);
	}
}

function getSingleValueLovID(product, attributeID) {
	logger.warning("product = " + product.getID());
	logger.warning("attributeID = " + attributeID);
	var value = product.getValue(attributeID);
	logger.warning("attributeValue = " + value);
	logger.warning("attributeValueID = " + value.getID());
	if (value) {
		return value.getID();
	}
	return null;
}
logger.warning("Asset test 1");
/*
function gateMandatoryAttributes(node, attributeGroup) {
	attributeGroup.getAllAttributes().toArray().forEach(function (attribute) {
		var value = node.getValue(attribute.getID());
		if(value) {
			var simpleValue = value.getSimpleValue();	
			if(!simpleValue) {
				// var message = "Missing value for mandatory attribute: " + attribute.getName();
				var message = (msg1+"").replace("%s", attribute.getName()); // "Missing value for mandatory attribute %s"

				log("... ... " + message);
				errors.add(message);
			}
		}
	});		
}

function gateMandatoryReferences(node, attributeGroup) {
	attributeGroup.getLinkTypes().toArray().forEach (
		function (referenceType) {					
			if(referenceType instanceof com.stibo.core.domain.ReferenceType) { 
				var references = node.getReferences(referenceType);
				//Check if the node has at least one referece of the type
				if(references.size() > 0) {
					//Do nothing
				} else {
					// var message = "Missing references for mandatory reference type: " + referenceType.getTitle();
					var message = (msg2+"").replace("%s", referenceType.getTitle()); // "Missing references for mandatory reference type: %s"

					log("... ... " + message);
					errors.add(message);
				}
			}
		}
	);					
}
*/

function getErrorsFormatted() {
	var result = "";
	errors.toArray().forEach(function (error) {if(result) {result = result + "<br>";} result = result + error;});
	return result;
}

// System Messages are stored on entities, for localization purpose.
var msg1 = manager.getEntityHome().getEntityByID("SysMsg_MissingValueForMandatoryAttribute").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Missing value for mandatory attribute %s
var msg2 = manager.getEntityHome().getEntityByID("SysMsg_MissingReferencesForMandatoryRefe").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Missing references for mandatory reference type: %s

var processedBy = getSingleValueLovID(node, "PMDM.AT.ProcessedBy");
var instance = node.getWorkflowInstance(workflow);
var buyerRework = instance.getValue("PMDM.AT.ProposalStatus").getID();
var buyerReworkMessage = instance.getSimpleVariable("MessageToSupplier");
logger.warning("Asset test 2");
//Product cannot be send for rework if product is processed by GDSN
if (processedBy && processedBy.equals("GDSN") && buyerRework && buyerRework.equals("RW")) {
	return AcceptReworkInconsistent4;
}
logger.warning("Asset test 3");
//Product cannot be send for rework or rejected if no rejection message exists
if (buyerRework && !buyerRework.equals("AP") && !buyerReworkMessage) {
	return AcceptReworkInconsistent;
}
logger.warning("Asset test 4");
//Product cannot be approved if a rejection message exists
if (buyerRework && buyerRework.equals("AP") && buyerReworkMessage) {
	logger.warning("Returning Entity " + AcceptReworkInconsistent2);
	return AcceptReworkInconsistent2;
}
logger.warning("Asset test 5");
// The following was removed when Supplier UI was removed. To enable again: 
// 1. Create a "PMDM.ATG.EXT.SupplierMandatoryData" attribute group
// 2. Add the attribute group as mandatory to the Proposal, Rework and Enrichment state of the External Source Record Handling workflow,
//    Enable "Include References" and add a "False If Processed By PDS" condition on the mandatory setting.
// 3. Add a "supplierMandatoryDataGroup" attribute group bind pointing to "PMDM.ATG.EXT.SupplierMandatoryData"
// 4. Uncomment the section below and the functions gateMandatoryAttributes and gateMandatoryReferences.
/*
//Check product for mandatory attributes and references if product is not processed by PDS
if (buyerRework && buyerRework.equals("AP")) {
	if (processedBy && processedBy.equals("PDS")) {
		//Do nothing
	} else {
		gateMandatoryAttributes(node, supplierMandatoryDataGroup);
		gateMandatoryReferences(node, supplierMandatoryDataGroup);
		if(errors.size() > 0) {
			log(errors);

			var message = AcceptReworkInconsistent5.concat(getErrorsFormatted()); // 'Product cannot be approved because of missing mandatory data:&lt;br&gt;%s'
			return (message);
		}	
	}
}
*/

//Error if non of the 3 options (Approve, Rework, Reject) is selected
logger.warning("Asset test 6");
if (!buyerRework) {
	logger.warning("Asset test 7");
	return AcceptReworkInconsistent3;
}
logger.warning("Asset approval test on condition end : condition");
return true;
  </javaScript>
</config> -->
                <Name>Asset Approval - Proceed - Condition</Name>
                <Configuration>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</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
            <LocalBusinessRule ID="con-b7256efc-20fe-4175-9f2d-64d5b30be521" Scope="Local" Type="Condition" RunPrivileged="true"><!-- Definition:
Condition #1 (JavaScriptBusinessConditionWithBinds):
<config>
  <bindings>
    <binding alias="node" type="Node" contract="CurrentObjectBindContract"/>
    <binding alias="workflow" type="Workflow" contract="CurrentWorkflowBindContract"/>
    <binding alias="logger" type="Logger" contract="LoggerBindContract"/>
    <binding alias="manager" type="Manager" contract="ManagerBindContract"/>
  </bindings>
  <messages/>
  <javaScript>
var debug = true;
var errors = new java.util.ArrayList();
var AcceptReworkInconsistent = manager.getEntityHome().getEntityByID("SysMsg_con-cc39_AcceptReworkInconsistent").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'You must populate the "Message to Supplier" field in the previous screen when either the "Rework" or "Reject" options are selected.'
var AcceptReworkInconsistent2 = manager.getEntityHome().getEntityByID("SysMsg_con-cc3_AcceptReworkInconsistent2").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'You must select either the "Rework" or "Reject" options in the previous screen whenever the "Message to Supplier" field has been populated.'
var AcceptReworkInconsistent3 = manager.getEntityHome().getEntityByID("SysMsg_con-cc3_AcceptReworkInconsistent3").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'You need to set a Proposal Status.'
var AcceptReworkInconsistent4 = manager.getEntityHome().getEntityByID("SysMsg_con-cc3_AcceptReworkInconsistent4").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'Products onboarded via GDSN cannot be returned for"Rework".'
var AcceptReworkInconsistent5 = manager.getEntityHome().getEntityByID("SysMsg_con-cc3_AcceptReworkInconsistent5").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // 'Product cannot be approved because of missing mandatory data:&lt;br&gt;%s'

function log(message) {
	if(debug) {
		logger.info("Proposal Approval Buyer: " + message);
	}
}

function getSingleValueLovID(product, attributeID) {
	var value = product.getValue(attributeID);
	if (value) {
		return value.getID();
	}
	return null;
}

/*
function gateMandatoryAttributes(node, attributeGroup) {
	attributeGroup.getAllAttributes().toArray().forEach(function (attribute) {
		var value = node.getValue(attribute.getID());
		if(value) {
			var simpleValue = value.getSimpleValue();	
			if(!simpleValue) {
				// var message = "Missing value for mandatory attribute: " + attribute.getName();
				var message = (msg1+"").replace("%s", attribute.getName()); // "Missing value for mandatory attribute %s"

				log("... ... " + message);
				errors.add(message);
			}
		}
	});		
}

function gateMandatoryReferences(node, attributeGroup) {
	attributeGroup.getLinkTypes().toArray().forEach (
		function (referenceType) {					
			if(referenceType instanceof com.stibo.core.domain.ReferenceType) { 
				var references = node.getReferences(referenceType);
				//Check if the node has at least one referece of the type
				if(references.size() > 0) {
					//Do nothing
				} else {
					// var message = "Missing references for mandatory reference type: " + referenceType.getTitle();
					var message = (msg2+"").replace("%s", referenceType.getTitle()); // "Missing references for mandatory reference type: %s"

					log("... ... " + message);
					errors.add(message);
				}
			}
		}
	);					
}
*/

function getErrorsFormatted() {
	var result = "";
	errors.toArray().forEach(function (error) {if(result) {result = result + "<br>";} result = result + error;});
	return result;
}

// System Messages are stored on entities, for localization purpose.
var msg1 = manager.getEntityHome().getEntityByID("SysMsg_MissingValueForMandatoryAttribute").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Missing value for mandatory attribute %s
var msg2 = manager.getEntityHome().getEntityByID("SysMsg_MissingReferencesForMandatoryRefe").getValue("PMDM.AT.SystemMessage").getSimpleValue(); // Missing references for mandatory reference type: %s

var processedBy = getSingleValueLovID(node, "PMDM.AT.ProcessedBy");
var instance = node.getWorkflowInstance(workflow);
var buyerRework = instance.getValue("PMDM.AT.ProposalStatus").getID();
var buyerReworkMessage = instance.getSimpleVariable("MessageToSupplier");

//Product cannot be send for rework if product is processed by GDSN
if (processedBy && processedBy.equals("GDSN") && buyerRework && buyerRework.equals("RW")) {
	return AcceptReworkInconsistent4;
}
//Product cannot be send for rework or rejected if no rejection message exists
if (buyerRework && !buyerRework.equals("AP") && !buyerReworkMessage) {
	return AcceptReworkInconsistent;
}
//Product cannot be approved if a rejection message exists
if (buyerRework && buyerRework.equals("AP") && buyerReworkMessage) {
	return AcceptReworkInconsistent2;
}

// The following was removed when Supplier UI was removed. To enable again: 
// 1. Create a "PMDM.ATG.EXT.SupplierMandatoryData" attribute group
// 2. Add the attribute group as mandatory to the Proposal, Rework and Enrichment state of the External Source Record Handling workflow,
//    Enable "Include References" and add a "False If Processed By PDS" condition on the mandatory setting.
// 3. Add a "supplierMandatoryDataGroup" attribute group bind pointing to "PMDM.ATG.EXT.SupplierMandatoryData"
// 4. Uncomment the section below and the functions gateMandatoryAttributes and gateMandatoryReferences.
/*
//Check product for mandatory attributes and references if product is not processed by PDS
if (buyerRework && buyerRework.equals("AP")) {
	if (processedBy && processedBy.equals("PDS")) {
		//Do nothing
	} else {
		gateMandatoryAttributes(node, supplierMandatoryDataGroup);
		gateMandatoryReferences(node, supplierMandatoryDataGroup);
		if(errors.size() > 0) {
			log(errors);

			var message = AcceptReworkInconsistent5.concat(getErrorsFormatted()); // 'Product cannot be approved because of missing mandatory data:&lt;br&gt;%s'
			return (message);
		}	
	}
}
*/

//Error if non of the 3 options (Approve, Rework, Reject) is selected
if (!buyerRework) {
	return AcceptReworkInconsistent3;
}

return true;
  </javaScript>
</config> -->
                <Name>Buyer Approval - Proceed - Condition</Name>
                <Configuration>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</Configuration>
                <ValidObjectTypes AllObjectTypesValid="true"></ValidObjectTypes>
            </LocalBusinessRule>
        </STEPWorkflow>
    </STEPWorkflows>
</STEP-ProductInformation>